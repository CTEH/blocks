<!doctype html>




<html>
  <head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KG9MQ69');</script>
    <!-- End Google Tag Manager -->

    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Blocks Docs - Blocks Docs</title>

    



<style>
  @font-face {
    font-family: 'slate';
    src:url("/blocks/fonts/slate.eot?-syv14m");
    src:url("/blocks/fonts/slate.eot?#iefix-syv14m") format('embedded-opentype'),
        url("/blocks/fonts/slate.woff2?-syv14m") format('woff2'),
        url("/blocks/fonts/slate.woff?-syv14m") format('woff'),
        url("/blocks/fonts/slate.ttf?-syv14m") format('truetype'),
        url("/blocks/fonts/slate.svg?-syv14m#slate") format('svg');
    font-weight: normal;
    font-style: normal;
  }
  /* bundle exec rougify style base16.monokai > _sass/_syntax.scss */
  /* Rouge::Themes::Base16::Monokai.render(:scope => '.highlight') */
</style>
<link href="/blocks/stylesheets/screen.css" media="screen" rel="stylesheet" type="text/css">
<link href="/blocks/stylesheets/print.css" media="print" rel="stylesheet" type="text/css">
<link rel="icon" type="image/x-icon" href="/blocks/images/favicon.ico">

<script src="/blocks/javascripts/lib/energize.js"></script>
<script src="/blocks/javascripts/lib/jquery.js"></script>
<script src="/blocks/javascripts/lib/jquery_ui.js"></script>
<script src="/blocks/javascripts/lib/jquery.tocify.js"></script>
<script src="/blocks/javascripts/lib/imagesloaded.min.js"></script>
<script src="/blocks/javascripts/lib/lunr.js"></script>
<script src="/blocks/javascripts/app/lang.js"></script>

  <script src="/blocks/javascripts/app/search.js"></script>

<script src="/blocks/javascripts/app/toc.js"></script>

  </head>

  <body class="" data-languages='["erb","haml","ruby"]'>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KG9MQ69"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="/blocks/images/navbar.png">
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="/blocks/images/logo.png">
      
  <div class="lang-selector">
    
      
        <a href="#" data-language-name="erb">erb</a>
      
    
      
        <a href="#" data-language-name="haml">haml</a>
      
    
      
        <a href="#" data-language-name="ruby">ruby</a>
      
    
  </div>


      
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      
      <div id="toc">
      </div>
      
        <ul class="toc-footer">
          
            <li><a href='https://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
          
        </ul>
      
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        

        
          
            <h1 id="features">Features</h1>

<p><strong>VERSION 4.0.0</strong></p>

<p>The <a href="http://github.com/hunterae/blocks">blocks gem</a> is many things.</p>

<p>It acts as:</p>

<ul>
  <li>a container for reusable blocks of code and options</li>
  <li>a common interface for rendering code, whether the code was defined previously in Ruby blocks, Ruby Methods, Rails partials, or proxies to other blocks of code</li>
  <li>a series of hooks and wrappers that can be utilized to render code before, after, and around other blocks of code, as well as before each, after each, and around each item in a collection</li>
  <li>a templating utility for easily building reusable and highly customizable UI components</li>
  <li>a means for DRYing up oft-repeated code in your layouts and views</li>
  <li>a simple mechanism for changing or skipping the rendering behavior for particular blocks of code</li>
</ul>

<p>Essentially, this all boils down to the following: Blocks makes it easy to define blocks of code that can be rendered either verbatim or with replacements and modifications at some later point in time.</p>

<p><a href="https://travis-ci.org/hunterae/blocks"><img src="https://travis-ci.org/hunterae/blocks.svg" alt="Build Status" /></a></p>

          
            <h1 id="installation--prerequisites">Installation &amp; Prerequisites</h1>

<p>Blocks requires Rails 3.0 or greater and Ruby 2.0 or greater.</p>

<p>It has been tested with Ruby 2.0.0 through 2.5.1 (as well as ruby-head), and Rails 3.0 - 5.2 (as well as Edge Rails)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem 'blocks'
</code></pre></div></div>

<aside class="notice">
Add this to your Gemfile:
</aside>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle <span class="nb">install</span>
</code></pre></div></div>

<aside class="notice">
Then run this from your project directory command line:
</aside>

<aside class="success">
In most cases, this will be all you need to do. The "blocks" helper method is now available within your Rails views
</aside>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">if</span> <span class="o">!</span><span class="no">Object</span><span class="p">.</span><span class="nf">respond_to?</span><span class="p">(</span><span class="ss">:yaml_as</span><span class="p">)</span>
  <span class="k">class</span> <span class="nc">Object</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">yaml_as</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
      <span class="n">yaml_tag</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<aside class="warning">
To get Blocks working for Rails 3.0 with a Ruby version of 2.5 or greater, use the following patch:
</aside>

          
            <h1 id="overview">Overview</h1>

<p>There are many ways to render content to the screen in web applications. Ruby on Rails offers a couple of default strategies right off the bat through its combination of ActionController, ActionView, and ERB templating language:</p>

<ul>
  <li>Rendering content within an ActionView template (the controller action) and layout</li>
  <li>Pulling in additional content through rendering partials</li>
  <li>Capturing content from a block and outputting that content at some later point</li>
  <li>Calling a different method from the controller action which determines what and how to render</li>
</ul>

<p>There are obviously additional means to render output, such as the redirect methods in a controller and rendering inline code, but generally speaking, most generated output come about through one of those above methods.</p>

<p>The approaches listed above can essentially be generalized as follows</p>

<ul>
  <li>Rendering using a method</li>
  <li>Rendering fragments (using a Rails’ partial)</li>
  <li>Storing content for later rendering (using a Ruby Block)</li>
  <li>Proxying to another source that knows what to / how to render</li>
</ul>

<p>The Blocks gem attempts to take these four concepts and provide one common interface.</p>

<p>The reasoning behind this is simple.</p>

          
            <h1 id="defining-blocks">Defining Blocks</h1>

<p>With Blocks, you can define a block of code for later rendering using Ruby blocks, Rails partials, and proxies to other blocks or methods.</p>

<p>A block consists of a name, an optional hash of options, and a rendering strategy (also called its definition).</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span> <span class="cp">%&gt;</span>
<span class="c">&lt;!-- SAME AS --&gt;</span>
<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"my_block"</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span>
<span class="nf">#-</span> SAME AS
<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"my_block"</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span>
<span class="c1"># SAME AS</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"my_block"</span>
</code></pre></div></div>

<p>A block’s name can be a symbol or a string. The underlying system treats symbols and strings the same. Therefore, any block that is defined with a String name can be accessed with its corresponding symbol name and vice-versa.</p>

<h2 id="with-a-ruby-block">With a Ruby Block</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  content
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span> <span class="k">do</span>
  content
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s2">"content"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>A Block may be defined as a standard Ruby block.</p>

<h3 id="with-a-proc">With a Proc</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">my_block</span> <span class="o">=</span>
  <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="s2">"content"</span> <span class="p">}</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
          <span class="ss">block: </span><span class="n">my_block</span> <span class="cp">%&gt;</span>
<span class="c">&lt;!-- OR --&gt;</span>
<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
                 <span class="o">&amp;</span><span class="n">my_block</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">my_block</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="s2">"content"</span> <span class="p">}</span>
<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
         <span class="ss">block: </span><span class="n">my_block</span>
<span class="c">-# OR
</span><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">my_block</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">my_block</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="s2">"content"</span> <span class="p">}</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">block: </span><span class="n">my_block</span>
<span class="c1">#OR...</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">my_block</span>
</code></pre></div></div>

<p>It may also be defined with a Proc</p>

<h3 id="with-a-lambda">With a Lambda</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">my_block</span> <span class="o">=</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="s2">"content"</span> <span class="p">}</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
          <span class="ss">block: </span><span class="n">my_block</span> <span class="cp">%&gt;</span>
<span class="c">&lt;!-- OR --&gt;</span>
<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">my_block</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Lambdas are kind of a pain in Haml
and Procs should be used instead
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">my_block</span> <span class="o">=</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="s2">"content"</span> <span class="p">}</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">block: </span><span class="n">my_block</span>
<span class="c1"># OR...</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">my_block</span>
</code></pre></div></div>

<p>It may also be defined with a Lambda</p>

<h2 id="with-a-rails-partial">With a Rails Partial</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
         <span class="ss">partial: </span><span class="s2">"my_partial"</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
       <span class="ss">partial: </span><span class="s2">"my_partial"</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="o">-</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
        <span class="ss">partial: </span><span class="s2">"my_partial"</span>
</code></pre></div></div>

<p>A Block may be defined as a Rails partial using the “partial” keyword in the parameters. Whenever the Block gets rendered, the partial actually gets rendered.</p>

<h2 id="with-a-proxy-to-another-block">With a Proxy to Another Block</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
           <span class="ss">with: :some_proxy_block</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
          <span class="ss">with: :some_proxy_block</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="o">-</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
           <span class="ss">with: :some_proxy_block</span>
</code></pre></div></div>

<p>A Block may be defined as a proxy to another block using the “with” keyword in the parameters.</p>

<h3 id="proxying-to-a-method">Proxying to a method</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
            <span class="ss">with: :column</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
           <span class="ss">with: :column</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
         <span class="ss">with: :column</span>
</code></pre></div></div>

<blockquote>
  <p>Where “builder” is an instance of a class that extends Blocks::Builder and has a method called “column”.</p>
</blockquote>

<p>The “with” keyword may also specify the name of a method that will be called on the builder instance when the block is rendered. By default, this will be an instance of Blocks::Builder.</p>

<p>Also, a Proxy block can point to a method on the builder instance (by default, this is an instance of Blocks::Builder).</p>

<h3 id="proxying-to-a-proxy">Proxying to a Proxy</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
           <span class="ss">with: :proxy_1</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:proxy_1</span><span class="p">,</span>
           <span class="ss">with: :proxy_2</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:proxy_2</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  My proxied proxied content
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
          <span class="ss">with: :proxy_1</span>
<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:proxy_1</span><span class="p">,</span>
          <span class="ss">with: :proxy_2</span>
<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:proxy_2</span> <span class="k">do</span>
  My proxied proxied content
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
         <span class="ss">with: :proxy_1</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:proxy_1</span><span class="p">,</span>
         <span class="ss">with: :proxy_2</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:proxy_2</span> <span class="k">do</span>
  <span class="s2">"My proxied proxied content"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Proxy Blocks can also be chained together though separate definitions. The order of Block definitions is irrelevant - with two caveats:</p>

<ol>
  <li>Proxies must be setup before attempting to render them</li>
  <li>If the same block name is defined multiple times with different proxy names, the first one defined will be used</li>
</ol>

<h2 id="with-multiple-definitions">With Multiple Definitions</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
        <span class="ss">partial: </span><span class="s2">"my_partial"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
        <span class="ss">with: :my_proxy</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  My Block Definition
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
       <span class="ss">partial: </span><span class="s2">"my_partial"</span>
<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
          <span class="ss">with: :my_proxy</span>
<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span> <span class="k">do</span>
  My Block Definition
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
      <span class="ss">partial: </span><span class="s2">"my_partial"</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
         <span class="ss">with: :my_proxy</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s2">"My Block Definition"</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>:my_block will use the partial: “my_partial” when rendered</p>
</blockquote>

<p>When multiple definitions for the same block name are provided, Blocks will utilize the first definition to occur, whether it’s a Ruby block, a Rails partial, or a Proxy to another block.</p>

<h2 id="without-a-definition">Without a Definition</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span>
</code></pre></div></div>

<p>Blocks do not need to have a definition provided. When they are rendered, no output is generated.</p>

<p>This, in itself, is not particularly useful, but can become more and more useful when block options and hooks and wrappers are combined.</p>

<h2 id="with-a-collection">With a Collection</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;li&gt;</span>Item: <span class="cp">&lt;%=</span> <span class="n">item</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
  <span class="nt">%li</span><span class="p">=</span> <span class="s2">"Item: </span><span class="si">#{</span><span class="n">item</span><span class="si">}</span><span class="s2">"</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span> <span class="ss">:li</span><span class="p">,</span>
    <span class="s2">"Item </span><span class="si">#{</span><span class="n">item</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>A collection may be defined for a block, in which case, when that block is rendered, it will actually render the block multiple times, once for each item in the collection.</p>

<aside class="warning">
When the block definition is a Ruby block, the block should be prepared to take each item from the collection as a parameter.
</aside>

<h3 id="with-an-alias">With an Alias</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
     <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
             <span class="ss">as: :item</span><span class="p">,</span>
        <span class="ss">partial: </span><span class="s2">"my_partial"</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
    <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
            <span class="ss">as: :item</span><span class="p">,</span>
       <span class="ss">partial: </span><span class="s2">"my_partial"</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
   <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
           <span class="ss">as: :item</span><span class="p">,</span>
      <span class="ss">partial: </span><span class="s2">"my_partial"</span>
</code></pre></div></div>

<p>Additionally, you can set an alias for each item in the collection as the collection is iterated over. This is done using the “as” option.</p>

<p>If the block being rendered is a partial, it will alias each item in the collection with the specified option (i.e. the value of the “as” option will become the name of the variable available in the partial being rendered and will contain each item in the collection being rendered). Additionally, “current_index” will also be a variable that can be accessed within the partial, and will correspond to the item’s index in the collection.</p>

<p>If the block being rendered is not a partial, it will store the alias name as a key in an options hash that will be optionally passed to the block when it is rendered. Additionally, “current_index” will store the item’s current index within the collection.</p>

<h3 id="without-an-alias">Without an Alias</h3>

<p>When no alias is specified and the block being rendered is a partial, it will alias each item in the collection as “object” (i.e. “object” will become the name of the variable available in the partial being rendered and will contain each item in the collection being rendered).
Additionally, “current_index” will also be a variable that can be accessed within the partial, and will correspond to the item’s index in the collection.</p>

<p>If the block being rendered is not a partial, it will store “object” as a key in an options hash that will be optionally passed to the block when it is rendered. Additionally, “current_index” will store the item’s current index within the collection.</p>

<h2 id="with-options">With Options</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"First setting of a"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"Second setting of a"</span><span class="p">,</span>
  <span class="ss">b: </span><span class="s2">"First setting of b"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"Third setting of a"</span><span class="p">,</span>
  <span class="ss">b: </span><span class="s2">"Second setting setting of b"</span><span class="p">,</span>
  <span class="ss">c: </span><span class="s2">"First setting of c"</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"First setting of a"</span>
<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"Second setting of a"</span><span class="p">,</span>
  <span class="ss">b: </span><span class="s2">"First setting of b"</span>
<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"Third setting of a"</span><span class="p">,</span>
  <span class="ss">b: </span><span class="s2">"Second setting setting of b"</span><span class="p">,</span>
  <span class="ss">c: </span><span class="s2">"First setting of c"</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"First setting of a"</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"Second setting of a"</span><span class="p">,</span>
  <span class="ss">b: </span><span class="s2">"First setting of b"</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"Third setting of a"</span><span class="p">,</span>
  <span class="ss">b: </span><span class="s2">"Second setting setting of b"</span><span class="p">,</span>
  <span class="ss">c: </span><span class="s2">"First setting of c"</span>
</code></pre></div></div>

<blockquote>
  <p>After running the above code, the options for :my_block will look like this:</p>
</blockquote>

<pre><code class="language-JavaScript">{
  a: "First setting of a",
  b: "First setting of b",
  c: "First setting of c"
}
</code></pre>

<p>Blocks are maintaining a merged, mutable options hash. This set is mutated with repeated calls to “define”.</p>

<p>When the same option key is used in successive “define” calls, the first call to define a key’s value is given priority.</p>

<h3 id="indifferent-access">Indifferent Access</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"First setting of a"</span><span class="p">,</span>
  <span class="s2">"b"</span> <span class="o">=&gt;</span> <span class="s2">"First setting of b"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="s2">"Second setting of a"</span><span class="p">,</span>
  <span class="ss">b: </span><span class="s2">"Second setting of b"</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"First setting of a"</span><span class="p">,</span>
  <span class="s2">"b"</span> <span class="o">=&gt;</span> <span class="s2">"First setting of b"</span>
<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="s2">"Second setting of a"</span><span class="p">,</span>
  <span class="ss">b: </span><span class="s2">"Second setting of b"</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance of</span>
<span class="c1">#  Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"First setting of a"</span><span class="p">,</span>
  <span class="s2">"b"</span> <span class="o">=&gt;</span> <span class="s2">"First setting of b"</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="s2">"Second setting of a"</span><span class="p">,</span>
  <span class="ss">b: </span><span class="s2">"First setting of b"</span>
</code></pre></div></div>

<blockquote>
  <p>After running the above code, the options for :my_block will look like this:</p>
</blockquote>

<pre><code class="language-JavaScript">{
  a: "First setting of a",
  b: "First setting of b"
}
</code></pre>

<p>Like the name of the block itself, the options hash does not care whether a symbol or a string is provided as a hash key; they are treated the same.</p>

<h3 id="deep-merging-of-options">Deep Merging of Options</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
              <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span>
     <span class="ss">shared_key: </span><span class="p">{</span>
       <span class="ss">a: </span><span class="s2">"a1"</span>
     <span class="p">}</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
              <span class="ss">b: </span><span class="mi">1</span><span class="p">,</span>
     <span class="ss">shared_key: </span><span class="p">{</span>
       <span class="ss">a: </span><span class="s2">"a2"</span><span class="p">,</span>
       <span class="ss">b: </span><span class="s2">"b1"</span>
     <span class="p">}</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
             <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span>
    <span class="ss">shared_key: </span><span class="p">{</span> <span class="ss">a: </span><span class="s2">"a1"</span> <span class="p">}</span>
<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
             <span class="ss">b: </span><span class="mi">1</span><span class="p">,</span>
    <span class="ss">shared_key: </span><span class="p">{</span> <span class="ss">a: </span><span class="s2">"a2"</span><span class="p">,</span>
                  <span class="ss">b: </span><span class="s2">"b1"</span> <span class="p">}</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance of</span>
<span class="c1">#  Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
            <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span>
   <span class="ss">shared_key: </span><span class="p">{</span>
     <span class="ss">a: </span><span class="s2">"a1"</span>
   <span class="p">}</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
            <span class="ss">b: </span><span class="mi">1</span><span class="p">,</span>
   <span class="ss">shared_key: </span><span class="p">{</span>
     <span class="ss">a: </span><span class="s2">"a2"</span><span class="p">,</span>
     <span class="ss">b: </span><span class="s2">"b1"</span>
   <span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>After running the above code, the options for :my_block will look like this:</p>
</blockquote>

<pre><code class="language-JavaScript">{
  a: 1,
  shared_key: {
    a: "a1",
    b: "b1"
  },
  b: 1
}
</code></pre>

<p>When the same option key is used in successive “define” calls and the values for the duplicate key are both hashes, they are deep merged, giving precedence for duplicate nested keys to whatever key was defined first.</p>

<h3 id="runtime-and-default-options">Runtime and Default Options</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"standard"</span><span class="p">,</span>
  <span class="ss">b: </span><span class="s2">"standard"</span><span class="p">,</span>
  <span class="ss">runtime: </span><span class="p">{</span>
    <span class="ss">a: </span><span class="s2">"runtime"</span><span class="p">,</span>
    <span class="ss">c: </span><span class="s2">"runtime"</span>
  <span class="p">},</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">a: </span><span class="s2">"default"</span><span class="p">,</span>
    <span class="ss">d: </span><span class="s2">"default"</span>
  <span class="p">}</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"standard"</span><span class="p">,</span>
  <span class="ss">b: </span><span class="s2">"standard"</span><span class="p">,</span>
  <span class="ss">runtime: </span><span class="p">{</span> <span class="ss">a: </span><span class="s2">"runtime"</span><span class="p">,</span>
             <span class="ss">c: </span><span class="s2">"runtime"</span> <span class="p">},</span>
  <span class="ss">defaults: </span><span class="p">{</span> <span class="ss">a: </span><span class="s2">"default"</span><span class="p">,</span>
              <span class="ss">d: </span><span class="s2">"default"</span> <span class="p">}</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance of</span>
<span class="c1">#  Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"standard"</span><span class="p">,</span>
  <span class="ss">b: </span><span class="s2">"standard"</span><span class="p">,</span>
  <span class="ss">runtime: </span><span class="p">{</span>
    <span class="ss">a: </span><span class="s2">"runtime"</span><span class="p">,</span>
    <span class="ss">c: </span><span class="s2">"runtime"</span>
  <span class="p">},</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">a: </span><span class="s2">"default"</span><span class="p">,</span>
    <span class="ss">d: </span><span class="s2">"default"</span>
  <span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>After running the above code, the options for :my_block will look like this:</p>
</blockquote>

<pre><code class="language-JavaScript">{
  a: "runtime",
  c: "runtime",
  b: "standard",
  d: "default"
}
</code></pre>

<p>There are three levels of options: runtime, standard, and default. They are given merge precedence in that order.</p>

<p>Runtime options are specified as a nested hash with “runtime” as the key.</p>

<p>Default options are specified as a nested hash with “defaults” as the key.</p>

<p>All other keys in the hash are considered standard options.</p>

<h2 id="with-parameters">With Parameters</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="mi">1</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span> <span class="cp">%&gt;</span>
  My options are <span class="cp">&lt;%=</span> <span class="n">options</span><span class="p">.</span><span class="nf">inspect</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="mi">1</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span>
  My options are
  <span class="p">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">inspect</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance of</span>
<span class="c1">#  Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="mi">1</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span>
  <span class="s2">"My options are </span><span class="si">#{</span><span class="n">options</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre></div></div>
<blockquote>
  <p>If this block were rendered, the output would be:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>My options are { a: 1 }
</code></pre></div></div>

<p>Every block that is defined with a Ruby block - or a proxy to a Block that is defined with a Ruby block, etc. - can optionally receive the merged options as a parameter.</p>

<h2 id="without-a-name">Without a Name</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>See Ruby tab
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>See Ruby tab
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance of</span>
<span class="c1">#  Blocks::Builder</span>
<span class="n">anonymous_block</span> <span class="o">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="k">do</span>
  <span class="s2">"hello"</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="n">anonymous_block</span><span class="p">.</span><span class="nf">name</span>
<span class="c1"># Outputs "anonymous_block_1"</span>

<span class="nb">puts</span> <span class="n">anonymous_block</span><span class="p">.</span><span class="nf">anonymous</span>
<span class="c1"># Outputs true</span>
</code></pre></div></div>

<p>Blocks may be defined without a name. When no block name is provided, an anonymous name will be generated.</p>

<aside class="notice">
  This is really only useful directly within the Ruby code or when extending the Blocks::Builder class.
</aside>

          
            <h1 id="rendering-blocks">Rendering Blocks</h1>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="cp">%&gt;</span>
<span class="c">&lt;!-- OR --&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="s2">"my_block"</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span>
<span class="nf">#-</span> OR
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="s2">"my_block"</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span>
<span class="c1"># OR</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="s2">"my_block"</span>
</code></pre></div></div>

<p>There is a single method to render a block that has been defined, regardless of that block’s rendering strategy (whether it’s a Ruby block, Rails partial, or a proxy to another block).</p>

<p>The name of the block being rendered can be a symbol or a string. The underlying system treats symbols and strings the same. Therefore, any block that is defined with a String name can be rendered with its corresponding symbol name and vice-versa.</p>

<p><img src="/blocks/images/render_strategies.png" /></p>

<h2 id="with-no-corresponding-definition">With no Corresponding Definition</h2>

<p>If a block is rendered without a definition, it doesn’t output anything (unless there are hooks or wrappers for the specified block), but it doesn’t fail either.</p>

<h2 id="with-a-default-definition">With a Default Definition</h2>

<p>Blocks provides the ability to specify a default definition for the block should no corresponding definition be found.</p>

<aside class="warning">
The default definition is not stored. It is used for the render call to which it is applied and then thrown away.
</aside>

<h3 id="with-a-ruby-block">With a Ruby Block</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  content
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="c">&lt;!-- OR --&gt;</span>

<span class="cp">&lt;%</span> <span class="n">my_block</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="s2">"content"</span> <span class="p">}</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="o">&amp;</span><span class="n">my_block</span> <span class="cp">%&gt;</span>

<span class="c">&lt;!-- OR --&gt;</span>

<span class="cp">&lt;%</span> <span class="n">my_block</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="s2">"content"</span> <span class="p">}</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span> <span class="ss">block: </span><span class="n">my_block</span> <span class="p">}</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  content

<span class="c">-# OR
</span>
<span class="p">-</span> <span class="n">my_block</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="s2">"content"</span> <span class="p">}</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">my_block</span>

<span class="c">-# OR
</span>
<span class="p">-</span> <span class="n">my_block</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="s2">"content"</span> <span class="p">}</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span> <span class="ss">block: </span><span class="n">my_block</span> <span class="p">}</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s2">"content"</span>
<span class="k">end</span>

<span class="c1"># OR</span>

<span class="n">my_block</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="s2">"content"</span> <span class="p">}</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">my_block</span>

<span class="c1"># OR</span>

<span class="n">my_block</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="s2">"content"</span> <span class="p">}</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span> <span class="ss">block: </span><span class="n">my_block</span> <span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>After running the above code, the output will be:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>content
</code></pre></div></div>

<p>The default definition can be specified as a Ruby block:</p>

<aside class="notice">
  Just as a block can be defined with a Ruby block that takes an optional "options" parameter, default definitions can also take an options parameter.
</aside>

<h3 id="with-a-rails-partial">With a Rails Partial</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span> <span class="ss">partial: </span><span class="s2">"my_partial"</span> <span class="p">}</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span> <span class="ss">partial: </span><span class="s2">"my_partial"</span> <span class="p">}</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span> <span class="ss">partial: </span><span class="s2">"my_partial"</span> <span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>After running the above code, the output will be whatever the result is of rendering the partial “my_partial”</p>
</blockquote>

<p>The default definition can be specified as a Rails partial:</p>

<h3 id="with-a-proxy-to-another-block">With a Proxy to Another Block</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span> <span class="ss">with: :proxy_block</span> <span class="p">}</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span> <span class="ss">with: :proxy_block</span> <span class="p">}</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span> <span class="ss">with: :proxy_block</span> <span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>After running the above code, the output will be whatever the result is of rendering the Proxy block or method called “some_other_block”</p>
</blockquote>

<p>The default definition can be specified as a proxy to another block:</p>

<h2 id="with-options">With Options</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">a: </span><span class="s2">"defaults"</span><span class="p">,</span>
    <span class="ss">b: </span><span class="s2">"defaults"</span>
  <span class="p">},</span>
  <span class="ss">a: </span><span class="s2">"runtime"</span><span class="p">,</span>
  <span class="ss">c: </span><span class="s2">"runtime"</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">options</span><span class="p">.</span><span class="nf">to_json</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span> <span class="ss">a: </span><span class="s2">"defaults"</span><span class="p">,</span>
              <span class="ss">b: </span><span class="s2">"defaults"</span> <span class="p">},</span>
  <span class="ss">a: </span><span class="s2">"runtime"</span><span class="p">,</span>
  <span class="ss">c: </span><span class="s2">"runtime"</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span>
  <span class="p">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">to_json</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">a: </span><span class="s2">"defaults"</span><span class="p">,</span>
    <span class="ss">b: </span><span class="s2">"defaults"</span>
  <span class="p">},</span>
  <span class="ss">a: </span><span class="s2">"runtime"</span><span class="p">,</span>
  <span class="ss">c: </span><span class="s2">"runtime"</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span>
  <span class="n">options</span><span class="p">.</span><span class="nf">to_json</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>The output would be:</p>
</blockquote>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"a"</span><span class="p">:</span><span class="s2">"runtime"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"c"</span><span class="p">:</span><span class="s2">"runtime"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"b"</span><span class="p">:</span><span class="s2">"defaults"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Just as options can be set for a block when the block is defined, they can also be applied at render.</p>

<p>Options provided to the render call can be either runtime options or default options (unlike defining blocks, there is no concept for render standard options).</p>

<p>Default options are specified within a nested hash under the key “defaults”.</p>

<p>All other options are considered to be runtime options. Runtime options provided to the render call will take precedence over all other options, including runtime options set on the block definition.</p>

<h3 id="indifferent-access">Indifferent Access</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="s2">"Block String"</span><span class="p">,</span>
  <span class="ss">b: </span><span class="s2">"Block Symbol"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"Runtime Symbol"</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">options</span><span class="p">.</span><span class="nf">to_json</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="s2">"Block String"</span><span class="p">,</span>
  <span class="ss">b: </span><span class="s2">"Block Symbol"</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"Runtime Symbol"</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span>
  <span class="p">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">to_json</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance of</span>
<span class="c1">#  Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="s2">"Block String"</span><span class="p">,</span>
  <span class="ss">b: </span><span class="s2">"Block Symbol"</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"Runtime Symbol"</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span>
  <span class="n">options</span><span class="p">.</span><span class="nf">to_json</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>The output would be:</p>
</blockquote>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"a"</span><span class="p">:</span><span class="s2">"Runtime Symbol"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"b"</span><span class="p">:</span><span class="s2">"Block Symbol"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>Note that the render options took precedence over the block options. This is because render options are treated as runtime options (unless they are wrapper inside of the defaults hash) which take the highest level of precedence when merging options.</p>
</blockquote>

<p>Like the name of the block itself, the options hash does not care whether a symbol or a string is provided as a hash key; they are treated the same.</p>

<h3 id="deep-merging-of-options">Deep Merging of Options</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span>
  <span class="ss">shared_key: </span><span class="p">{</span>
    <span class="ss">a: </span><span class="s2">"a1"</span><span class="p">,</span>
    <span class="ss">c: </span><span class="s2">"c1"</span>
  <span class="p">}</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">b: </span><span class="mi">1</span><span class="p">,</span>
  <span class="ss">shared_key: </span><span class="p">{</span>
    <span class="ss">a: </span><span class="s2">"a2"</span><span class="p">,</span>
    <span class="ss">b: </span><span class="s2">"b1"</span>
  <span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">options</span><span class="p">.</span><span class="nf">to_json</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
             <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span>
    <span class="ss">shared_key: </span><span class="p">{</span> <span class="ss">a: </span><span class="s2">"a1"</span><span class="p">,</span>
                  <span class="ss">c: </span><span class="s2">"c1"</span><span class="p">}</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
             <span class="ss">b: </span><span class="mi">1</span><span class="p">,</span>
    <span class="ss">shared_key: </span><span class="p">{</span> <span class="ss">a: </span><span class="s2">"a2"</span><span class="p">,</span>
                  <span class="ss">b: </span><span class="s2">"b1"</span> <span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span>
  <span class="p">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">to_json</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance of</span>
<span class="c1">#  Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span>
  <span class="ss">shared_key: </span><span class="p">{</span>
    <span class="ss">a: </span><span class="s2">"a1"</span><span class="p">,</span>
    <span class="ss">c: </span><span class="s2">"c1"</span>
  <span class="p">}</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">b: </span><span class="mi">1</span><span class="p">,</span>
  <span class="ss">shared_key: </span><span class="p">{</span>
    <span class="ss">a: </span><span class="s2">"a2"</span><span class="p">,</span>
    <span class="ss">b: </span><span class="s2">"b1"</span>
  <span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span>
  <span class="n">options</span><span class="p">.</span><span class="nf">to_json</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>The output would be:</p>
</blockquote>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"b"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"shared_key"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"a"</span><span class="p">:</span><span class="s2">"a2"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"c"</span><span class="p">:</span><span class="s2">"c1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"b"</span><span class="p">:</span><span class="s2">"b1"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"a"</span><span class="p">:</span><span class="mi">1</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>When the block definition and the render options share a duplicate key with hashes as their values, they are deep merged, giving precedence for duplicate nested keys to the render options.</p>

<h2 id="with-parameters">With Parameters</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">param_1</span><span class="p">,</span> <span class="n">param_2</span><span class="p">,</span> <span class="n">param_3</span><span class="p">,</span> <span class="n">param_4</span><span class="o">|</span> <span class="cp">%&gt;</span>
  Param 1: <span class="cp">&lt;%=</span> <span class="n">param_1</span><span class="p">.</span><span class="nf">inspect</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;br&gt;</span>
  Param 2: <span class="cp">&lt;%=</span> <span class="n">param_2</span><span class="p">.</span><span class="nf">inspect</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;br&gt;</span>
  Param 3: <span class="cp">&lt;%=</span> <span class="n">param_3</span><span class="p">.</span><span class="nf">inspect</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;br&gt;</span>
  Param 4: <span class="cp">&lt;%=</span> <span class="n">param_4</span><span class="p">.</span><span class="nf">inspect</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

Without a Collection:
<span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;br&gt;</span>
With a Collection:
<span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"Item1"</span><span class="p">,</span> <span class="s2">"Item2"</span><span class="p">]</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">param_1</span><span class="p">,</span>
    <span class="n">param_2</span><span class="p">,</span> <span class="n">param_3</span><span class="p">,</span> <span class="n">param_4</span><span class="o">|</span>
  Param 1:
  <span class="p">=</span> <span class="n">param_1</span><span class="p">.</span><span class="nf">inspect</span>
  <span class="nt">%br</span>
  Param 2:
  <span class="p">=</span> <span class="n">param_2</span><span class="p">.</span><span class="nf">inspect</span>
  <span class="nt">%br</span>
  Param 3:
  <span class="p">=</span> <span class="n">param_3</span><span class="p">.</span><span class="nf">inspect</span>
  <span class="nt">%br</span>
  Param 4:
  <span class="p">=</span> <span class="n">param_4</span><span class="p">.</span><span class="nf">inspect</span>
  <span class="nt">%br</span>

Without a Collection:
<span class="nt">%br</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span>
<span class="nt">%br</span>
With a Collection:
<span class="nt">%br</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"Item1"</span><span class="p">,</span> <span class="s2">"Item2"</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">param_1</span><span class="p">,</span>
    <span class="n">param_2</span><span class="p">,</span> <span class="n">param_3</span><span class="p">,</span> <span class="n">param_4</span><span class="o">|</span>
  <span class="s2">"Param 1: </span><span class="si">#{</span><span class="n">param_1</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
  <span class="s2">"Param 2: </span><span class="si">#{</span><span class="n">param_2</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
  <span class="s2">"Param 3: </span><span class="si">#{</span><span class="n">param_3</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
  <span class="s2">"Param 4: </span><span class="si">#{</span><span class="n">param_4</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
<span class="k">end</span>

<span class="s2">"Without a Collection:&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="ss">:my_block</span><span class="p">,</span>
  <span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
<span class="s2">"&lt;br&gt;With a Collection:&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="ss">:my_block</span><span class="p">,</span>
  <span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"Item1"</span><span class="p">,</span> <span class="s2">"Item2"</span><span class="p">])</span>
</code></pre></div></div>

<blockquote>
  <p>This will produce the following output</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Without a Collection:
Param 1: "foo"
Param 2: "bar"
Param 3: {"a"=&gt;1, "b"=&gt;2}
Param 4: nil

With a Collection:
Param 1: "Item1"
Param 2: "foo"
Param 3: "bar"
Param 4: {"a"=&gt;1, "b"=&gt;2, "object"=&gt;"Item1", "current_index"=&gt;0}
Param 1: "Item2"
Param 2: "foo"
Param 3: "bar"
Param 4: {"a"=&gt;1, "b"=&gt;2, "object"=&gt;"Item2", "current_index"=&gt;1}
</code></pre></div></div>

<p>Blocks are also capable of taking additional parameters besides potentially the options and the item if a collection is being rendered.</p>

<p>Though this concept is still relatively limited in its potential uses at this time (and some additional use cases probably still need to be hammered out), it can be used to pass an arbitrary number of additional parameters to a defined block.</p>

<p>At this time, this will not do anything meaningful if the Block is defined to render a partial. However, if the Block is defined to be a Ruby block or a Proxy to a Block defined with a Ruby block, Blocks will attempt to match up the number of arguments the block expects with the number of arguments that could be sent to it from the render call.</p>

<p>Remember, options will always be the last argument, and if rendering a collection, item will be the first. Any additional params passed to the render call will then be sent as the second argument onward, followed by the options hash. However, if fewer arguments are expected by the block than are sent, Blocks will send the lesser number of arguments.</p>

<p>See the example to the right to make better sense out of what is being explained here.</p>

<aside class="notice">
  Take note that passing a collection into the render call changes the first parameter to the block to the item in the collection and shifts the rest of the arguments over.
</aside>

<h2 id="with-a-collection">With a Collection</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ul&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;li&gt;</span>Item: <span class="cp">&lt;%=</span> <span class="n">item</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="c">&lt;!-- OR --&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
      <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;ul&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;li&gt;</span>Item: <span class="cp">&lt;%=</span> <span class="n">item</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">%ul</span>
  <span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
    <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
    <span class="nt">%li</span><span class="p">=</span> <span class="s2">"Item: </span><span class="si">#{</span><span class="n">item</span><span class="si">}</span><span class="s2">"</span>

<span class="c">-# OR
</span>
<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="nt">%ul</span>
  <span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
    <span class="nt">%li</span><span class="p">=</span> <span class="s2">"Item: </span><span class="si">#{</span><span class="n">item</span><span class="si">}</span><span class="s2">"</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span> <span class="ss">:ul</span> <span class="k">do</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
    <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
    <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span> <span class="ss">:li</span><span class="p">,</span>
      <span class="s2">"Item </span><span class="si">#{</span><span class="n">item</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># OR</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span> <span class="ss">:ul</span> <span class="k">do</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
    <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span> <span class="ss">:li</span><span class="p">,</span>
      <span class="s2">"Item </span><span class="si">#{</span><span class="n">item</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>The output would be:</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span>Item: 1<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>Item: 2<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>Item: 3<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>Item: 4<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div>

<p>A collection may be defined when rendering a block, or it may have already been defined when the block was defined. When the block is rendered, it will actually render the block multiple times, once for each item in the collection.</p>

<aside class="warning">
  Since render options take precedence over block options, if a collection is defined both on the block definition and passed to the render call, the collection provided to the render call will be given precedence.
</aside>

<aside class="warning">
When the block definition is a Ruby block, the block should be prepared to take each item from the collection as its first parameter.
</aside>

<h3 id="with-an-alias">With an Alias</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
        <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
        <span class="ss">as: :card</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="p">,</span> <span class="n">options</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      Item: <span class="cp">&lt;%=</span> <span class="n">item</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;br&gt;</span>
      Options: <span class="cp">&lt;%=</span> <span class="n">options</span><span class="p">.</span><span class="nf">to_hash</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">%ul</span>
  <span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
    <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
    <span class="ss">as: :card</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="p">,</span> <span class="n">options</span><span class="o">|</span>
    <span class="nt">%li</span>
      <span class="p">=</span><span class="s2">"Item: </span><span class="si">#{</span><span class="n">item</span><span class="si">}</span><span class="s2">"</span>
      <span class="nt">%br</span>
      <span class="p">=</span><span class="s2">"Options: </span><span class="si">#{</span><span class="n">options</span><span class="p">.</span><span class="nf">to_hash</span><span class="si">}</span><span class="s2">"</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span> <span class="ss">:ul</span> <span class="k">do</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
    <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
    <span class="ss">as: :card</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="p">,</span> <span class="n">options</span><span class="o">|</span>
    <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span> <span class="ss">:li</span> <span class="k">do</span>
      <span class="s2">"Item </span><span class="si">#{</span><span class="n">item</span><span class="si">}</span><span class="s2">"</span> <span class="o">+</span>
      <span class="s2">"&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
      <span class="s2">"Options: </span><span class="si">#{</span><span class="n">options</span><span class="p">.</span><span class="nf">to_hash</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>The output would be:</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span>
    Item: 1
    <span class="nt">&lt;br&gt;</span>
    Options: {
      "card"=&gt;1,
      "current_index"=&gt;0
    }
  <span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>
    Item: 2
    <span class="nt">&lt;br&gt;</span>
    Options: {
      "card"=&gt;2,
      "current_index"=&gt;1
    }
  <span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>
    Item: 3
    <span class="nt">&lt;br&gt;</span>
    Options: {
      "card"=&gt;3,
      "current_index"=&gt;2
    }
  <span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>
    Item: 4
    <span class="nt">&lt;br&gt;</span>
    Options: {
      "card"=&gt;4,
      "current_index"=&gt;3
    }
  <span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div>

<p>Additionally, you can set an alias for each item in the collection as the collection is iterated over. This is done using the “as” option.</p>

<p>If the block being rendered is a partial, it will alias each item in the collection with the specified option (i.e. the value of the “as” option will become the name of the variable available in the partial being rendered and will contain each item in the collection being rendered). Additionally, “current_index” will also be a variable that can be accessed within the partial, and will correspond to the item’s index in the collection.</p>

<p>If the block being rendered is not a partial, it will store the alias name as a key in an options hash that will be optionally passed to the block when it is rendered. Additionally, “current_index” will store the item’s current index within the collection.</p>

<h3 id="without-an-alias">Without an Alias</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ul&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="p">,</span> <span class="n">options</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;li&gt;</span>
    Item: <span class="cp">&lt;%=</span> <span class="n">i</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;br&gt;</span>
    Options: <span class="cp">&lt;%=</span> <span class="n">options</span><span class="p">.</span><span class="nf">to_hash</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/li&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">%ul</span>
  <span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
    <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="p">,</span> <span class="n">options</span><span class="o">|</span>
    <span class="nt">%li</span>
      <span class="p">=</span><span class="s2">"Item: </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span>
      <span class="nt">%br</span>
      <span class="p">=</span><span class="s2">"Options: </span><span class="si">#{</span><span class="n">options</span><span class="p">.</span><span class="nf">to_hash</span><span class="si">}</span><span class="s2">"</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span> <span class="ss">:ul</span> <span class="k">do</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
    <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="p">,</span> <span class="n">options</span><span class="o">|</span>
    <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span> <span class="ss">:li</span> <span class="k">do</span>
      <span class="s2">"Item </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span> <span class="o">+</span>
      <span class="s2">"&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
      <span class="s2">"Options: </span><span class="si">#{</span><span class="n">options</span><span class="p">.</span><span class="nf">to_hash</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>The output would be:</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span>
    Item: 1
    <span class="nt">&lt;br&gt;</span>
    Options: {
      "object"=&gt;1,
      "current_index"=&gt;0
    }
  <span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>
    Item: 2
    <span class="nt">&lt;br&gt;</span>
    Options: {
      "object"=&gt;2,
      "current_index"=&gt;1
    }
  <span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div>

<p>When no alias is specified and the block being rendered is a partial, it will alias each item in the collection as “object” (i.e. “object” will become the name of the variable available in the partial being rendered and will contain each item in the collection being rendered).
Additionally, “current_index” will also be a variable that can be accessed within the partial, and will correspond to the item’s index in the collection.</p>

<p>If the block being rendered is not a partial, it will store “object” as a key in an options hash that will be optionally passed to the block when it is rendered. Additionally, “current_index” will store the item’s current index within the collection.</p>

<h2 id="without-a-name">Without a Name</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- rendering a partial --&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">partial:
  </span><span class="s2">"a_partial"</span> <span class="cp">%&gt;</span>

<span class="c">&lt;!-- with local options --&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">,</span>
  <span class="ss">partial: </span><span class="s2">"a_partial"</span> <span class="cp">%&gt;</span>

<span class="c">&lt;!-- and a collection --&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">,</span>
  <span class="ss">partial: </span><span class="s2">"a_partial"</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="cp">%&gt;</span>

<span class="c">&lt;!-- rendering with a proxy --&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">with:
  :some_proxy</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">-# rendering a partial
</span><span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">partial: </span><span class="s2">"a_partial"</span>

<span class="c">-# with local options
</span><span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">partial: </span><span class="s2">"a_partial"</span><span class="p">,</span>
  <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span>

<span class="c">-# and a collection
</span><span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">partial: </span><span class="s2">"a_partial"</span><span class="p">,</span>
  <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="c">-# rendering with a proxy
</span><span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">with: :some_proxy</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>

<span class="c1"># rendering a partial</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">partial: </span><span class="s2">"a_partial"</span>

<span class="c1"># with local options</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">partial: </span><span class="s2">"a_partial"</span><span class="p">,</span>
  <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span>

<span class="c1"># and a collection</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">partial: </span><span class="s2">"a_partial"</span><span class="p">,</span>
  <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">collection: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="c1"># rendering with a proxy</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">with: :some_proxy</span>
</code></pre></div></div>

<p>Blocks may be rendered without a block name.</p>

<p>This is usually done in combination with a wrapper, a proxy, or a partial.</p>

<p>Use this when you don’t need corresponding hooks for the block to be rendered or when wanting to render a partial or a proxy block.</p>

          
            <h1 id="hooking-blocks">Hooking Blocks</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"before_all" hooks
"around_all" hooks
  "around" hooks
    "before" hooks
      "surround" hook
        "prepend" hooks
        block
        "append" hooks
    "after" hooks
"after_all" hooks
</code></pre></div></div>

<p>Hooks may be registered for a specific block that render additional code in relation to the block when the block is rendered.</p>

<p>There is no limit to the number of hooks that may be registered for a block, and multiple hooks may be registered of the same hook type for a block.</p>

<aside class="notice">
  Hooks will still render even if there is no associated block to be rendered.
</aside>

<p>Hooks fall into three categories:</p>

<h2 id="before-hooks">Before Hooks</h2>

<p>Before hooks render code before their corresponding block renders.</p>

<aside class="warning">
  All Before hooks of a given type will render in reverse order from the order in which they are registered.
</aside>

<p>There are three levels of “before” hooks:</p>

<h3 id="prepend-hooks">“prepend” Hooks</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">prepend</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "prepend" call 1
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="cp">%&gt;</span>
  "surround" call before
  <span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  "surround" call after
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">prepend</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "prepend" call 2
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "my_block" content
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">prepend</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "prepend" call 1
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  "surround" call before
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span>
  "surround" call after
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">prepend</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "prepend" call 2
  <span class="nt">%br</span>

<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "my_block" content
  <span class="nt">%br</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">prepend</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"prepend" call 1'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="s1">'"surround" call before'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s1">'"surround" call after'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">prepend</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"prepend" call 2'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"my_block" content'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>The output will be:</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"surround" call before
"prepend" call 2
"prepend" call 1
"my_block" content
"surround" call after
</code></pre></div></div>

<p>“prepend” hooks render content that immediately precedes the block content itself.</p>

<p>They render in closest proximity to the block along with the their sibling “append” hooks.</p>

<p>Together with the block content itself and the sibling “append” hooks, they can be surrounded with “surround” calls.</p>

<aside class="notice">
  Take note that the second "prepend" call content rendered first and that the "surround" call surrounded all the prepended content as well as the content block itself.
</aside>

<h3 id="before-hooks-1">“before” Hooks</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "before" call 1
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="cp">%&gt;</span>
  "surround" call before
  <span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  "surround" call after
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="cp">%&gt;</span>
  "Around" call before
  <span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  "Around" call after
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "before" call 2
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "my_block" content
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "before" call 1
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  "surround" call before
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span>
  "surround" call after
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  "around" call before
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span>
  "around" call after
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "before" call 2
  <span class="nt">%br</span>

<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "my_block" content
  <span class="nt">%br</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"before" call 1'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="s1">'"surround" call before'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s1">'"surround" call after'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="s1">'"around" call before'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s1">'"around" call after'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"before" call 2'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"my_block" content'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>The output will be:</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"around" call before
"before" call 2
"before" call 1
"surround" call before
"my_block" content
"surround" call after
"around" call after
</code></pre></div></div>

<p>“before” hooks render content before “surround” hooks.</p>

<p>Together with the all “surround” content and the sibling “after” hooks, they can be surrounded with “around” calls.</p>

<aside class="notice">
  Take note that the second "before" call content rendered first and that the "around" call surrounded all the before content as well as the surrounded content.
</aside>

<h3 id="before_all-hooks">“before_all” Hooks</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before_all</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "before" call 1
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around_all</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="cp">%&gt;</span>
  "around_all" call before
  <span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  "around_all" call after
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before_all</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "before_all" call 2
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "my_block" content
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before_all</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "before_all" call 1
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around_all</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  "around_all" call before
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span>
  "around_all" call after
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before_all</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "before_all" call 2
  <span class="nt">%br</span>

<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "my_block" content
  <span class="nt">%br</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"before" call 1'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="s1">'"surround" call before'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s1">'"surround" call after'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="s1">'"around" call before'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s1">'"around" call after'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"before" call 2'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"my_block" content'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>The output will be:</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"before_all" call 2
"before_all" call 1
"around_all" call before
"my_block" content
"around_all" call after
</code></pre></div></div>

<p>“before_all” hooks render content before anything else, including any “around_all” hooks.</p>

<aside class="notice">
  Take note that the second "before_all" call content rendered first before anything else including the "around_all" hook.
</aside>

<h2 id="after-hooks">After Hooks</h2>

<p>After hooks render code before their corresponding block renders.</p>

<aside class="warning">
  Unlike "Before" and "Around" hooks, "After" hooks of a given type will render in the order in which they are registered.
</aside>

<p>There are three levels of “after” hooks:</p>

<h3 id="append-hooks">“append” Hooks</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">append</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "append" call 1
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="cp">%&gt;</span>
  "surround" call before
  <span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  "surround" call after
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">append</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "append" call 2
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "my_block" content
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">append</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "append" call 1
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  "surround" call before
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span>
  "surround" call after
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">append</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "append" call 2
  <span class="nt">%br</span>

<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "my_block" content
  <span class="nt">%br</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">append</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"prepend" call 1'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="s1">'"surround" call before'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s1">'"surround" call after'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">append</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"prepend" call 2'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"my_block" content'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>The output will be:</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"surround" call before
"my_block" content
"append" call 1
"append" call 2
"surround" call after
</code></pre></div></div>

<p>“append” hooks render content that immediately follows the block content itself.</p>

<p>They render in closest proximity to the block along with the their sibling “prepend” hooks.</p>

<p>Together with the block content itself and the sibling “prepend” hooks, they can be surrounded with “surround” calls.</p>

<aside class="notice">
  Take note that the second "append" call content rendered after the first and that the "surround" call surrounded all the appended content as well as the content block itself.
</aside>

<h3 id="after-hooks-1">“after” Hooks</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "after" call 1
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="cp">%&gt;</span>
  "surround" call before
  <span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  "surround" call after
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="cp">%&gt;</span>
  "Around" call before
  <span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  "Around" call after
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "after" call 2
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "my_block" content
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "after" call 1
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  "surround" call before
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span>
  "surround" call after
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  "around" call before
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span>
  "around" call after
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "after" call 2
  <span class="nt">%br</span>

<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "my_block" content
  <span class="nt">%br</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"after" call 1'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="s1">'"surround" call before'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s1">'"surround" call after'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="s1">'"around" call before'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s1">'"around" call after'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"after" call 2'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"my_block" content'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>The output will be:</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"around" call before
"surround" call before
"my_block" content
"surround" call after
"after" call 1
"after" call 2
"around" call after
</code></pre></div></div>

<p>“after” hooks render content after “surround” hooks.</p>

<p>Together with the all “surround” content and the sibling “before” hooks, they can be surrounded with “around” calls.</p>

<aside class="notice">
  Take note that the second "after" call content rendered after the first and that the "around" call surrounded all the after content as well as the surrounded content.
</aside>

<h3 id="after_all-hooks">“after_all” Hooks</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">after_all</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "after_all" call 1
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around_all</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="cp">%&gt;</span>
  "around_all" call before
  <span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  "around_all" call after
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">after_all</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "after_all" call 2
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "my_block" content
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">after_all</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "after_all" call 1
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around_all</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  "around_all" call before
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span>
  "around_all" call after
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">after_all</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "after_all" call 2
  <span class="nt">%br</span>

<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "my_block" content
  <span class="nt">%br</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">after_all</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"after_all" call 1'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="s1">'"surround" call before'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s1">'"surround" call after'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="s1">'"around" call before'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s1">'"around" call after'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">after_all</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"after_all" call 2'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"my_block" content'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>The output will be:</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"around_all" call before
"my_block" content
"around_all" call after
"after_all" call 1
"after_all" call 2
</code></pre></div></div>

<p>“after_all” hooks render content after anything else, including any “around_all” hooks.</p>

<aside class="notice">
  Take note that the second "after_all" call content rendered after everything else.
</aside>

<h2 id="around-hooks">Around Hooks</h2>

<p>Around hooks render code around their corresponding block, allowing the hook to render code before the block renders, pass control over to the rendering block, and then regain control once the block has rendered.</p>

<aside class="warning">
  Around hooks are expected to be provided a block which takes a block as its first argument. They should "call" that block when they are ready to pass control to the content they are surrounding.
</aside>

<aside class="warning">
  All around hooks of a given type will render in reverse order from the order in which they are registered.
</aside>

<p>There are three levels of around hooks:</p>

<h3 id="surround-hooks">“surround” Hooks</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">prepend</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "prepend" call
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "before" call
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">append</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "append" call
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "after" call
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="cp">%&gt;</span>
  "surround" call 1 before
  <span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  "surround" call 1 after
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="cp">%&gt;</span>
  "surround" call 2 before
  <span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  "surround" call 2 after
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "my_block" content
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">prepend</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "prepend" call
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "before" call
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">append</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "append" call
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "after" call
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  "surround" call 1 before
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span>
  "surround" call 1 after
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  "surround" call 2 before
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span>
  "surround" call 2 after
  <span class="nt">%br</span>

<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "my_block" content
  <span class="nt">%br</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">prepend</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"prepend" call'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"before" call'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">append</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"append" call'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"after" call'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="s1">'"surround" call 1 before'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s1">'"surround" call 1 after'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="s1">'"surround" call 2 before'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s1">'"surround" call 2 after'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"my_block" content'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>The output will be:</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"before" call
"surround" call 2 before
"surround" call 1 before
"prepend" call
"my_block" content
"append" call
"surround" call 1 after
"surround" call 2 after
"after" call
</code></pre></div></div>

<p>“surround” hooks render content that surround the combination of “prepend” hooks, the block content, and “append” hooks. The can be preceded by “before” hooks and followed by “after” hooks.</p>

<aside class="notice">
  Take note that the second "surround" call content rendered around the first.
</aside>

<h3 id="around-hooks-1">“around” Hooks</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "before" call
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "after" call
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="cp">%&gt;</span>
  "around" call 1 before
  <span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  "around" call 1 after
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around_all</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="cp">%&gt;</span>
  "around_all" call before
  <span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  "around_all" call after
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="cp">%&gt;</span>
  "around" call 2 before
  <span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  "around" call 2 after
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "my_block" content
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "before" call
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "after" call
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  "around" call 1 before
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span>
  "around" call 1 after
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around_all</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  "around_all" call before
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span>
  "around_all" call after
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  "around" call 2 before
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span>
  "around" call 2 after
  <span class="nt">%br</span>

<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "my_block" content
  <span class="nt">%br</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"before" call'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"after" call'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="s1">'"around" call 1 before'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s1">'"around" call 1 after'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">around_all</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="s1">'"around_all" call before'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s1">'"around_all" call after'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="s1">'"around" call 2 before'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s1">'"around" call 2 after'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"my_block" content'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>The output will be:</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"around_all" call before
"around" call 2 before
"around" call 1 before
"before" call
"my_block" content
"after" call
"around" call 1 after
"around" call 2 after
"around_all" call after
</code></pre></div></div>

<p>“around” hooks render content that surrounds the combination of “before” hooks, “surround” content, and “after” hooks. They can be surrounded by “around_all” hooks.</p>

<aside class="notice">
  Take note that the second "around" call content rendered around the first.
</aside>

<h3 id="around_all-hooks">“around_all” Hooks</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "before" call
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "after" call
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="cp">%&gt;</span>
  "around" call 1 before
  <span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  "around" call 1 after
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around_all</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="cp">%&gt;</span>
  "around_all" call before
  <span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  "around_all" call after
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="cp">%&gt;</span>
  "around" call 2 before
  <span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  "around" call 2 after
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  "my_block" content
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before_all</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "before_all" call
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">after_all</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "after_all" call
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around_all</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  "around_all" call 1 before
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span>
  "around_all" call 1 after
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  "around" call before
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span>
  "around" call after
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around_all</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  "around_all" call 2 before
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span>
  "around_all" call 2 after
  <span class="nt">%br</span>

<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  "my_block" content
  <span class="nt">%br</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">before_all</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"before_all" call'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">after_all</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"after_all" call'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">around_all</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="s1">'"around_all" call 1 before'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s1">'"around_all" call 1 after'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="s1">'"around" call before'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s1">'"around" call after'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">around_all</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="s1">'"around_all" call 2 before'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s1">'"around_all" call 2 after'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s1">'"my_block" content'</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span><span class="p">(</span><span class="ss">:br</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>The output will be:</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"before_all" call
"around_all" call 2 before
"around_all" call 1 before
"around" call before
"my_block" content
"around" call after
"around_all" call 1 after
"around_all" call 2 after
"after_all" call
</code></pre></div></div>

<p>“around_all” hooks render content that surrounds “around” hooks. They can be preceded by “before_all” hooks and followed by “after_all” hooks.</p>

<aside class="notice">
  Take note that the second "around_all" call content rendered around the first.
</aside>

<h2 id="with-options">With Options</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"Block def"</span><span class="p">,</span>
  <span class="ss">b: </span><span class="s2">"Block def"</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"Hook def"</span><span class="p">,</span>
  <span class="ss">c: </span><span class="s2">"Hook def"</span> <span class="k">do</span> <span class="o">|</span><span class="n">block</span><span class="p">,</span> <span class="n">options</span><span class="o">|</span> <span class="cp">%&gt;</span>
  Options are <span class="cp">&lt;%=</span> <span class="n">options</span><span class="p">.</span><span class="nf">inspect</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">block</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"Block def"</span><span class="p">,</span>
  <span class="ss">b: </span><span class="s2">"Block def"</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"Hook def"</span><span class="p">,</span>
  <span class="ss">c: </span><span class="s2">"Hook def"</span> <span class="k">do</span> <span class="o">|</span><span class="n">block</span><span class="p">,</span> <span class="n">options</span><span class="o">|</span>
  Options are
  <span class="p">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">inspect</span>
  <span class="p">=</span> <span class="n">block</span><span class="p">.</span><span class="nf">call</span>

<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"Block def"</span><span class="p">,</span>
  <span class="ss">b: </span><span class="s2">"Block def"</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">a: </span><span class="s2">"Hook def"</span><span class="p">,</span>
  <span class="ss">c: </span><span class="s2">"Hook def"</span> <span class="k">do</span> <span class="o">|</span><span class="n">block</span><span class="p">,</span> <span class="n">options</span><span class="o">|</span>

  <span class="s2">"Options are </span><span class="si">#{</span><span class="n">options</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">block</span><span class="p">.</span><span class="nf">call</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span>
</code></pre></div></div>

<blockquote>
  <p>When rendered, this will produce the following output:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Options are {
  "a"=&gt;"Hook def",
  "c"=&gt;"Hook def",
  "b"=&gt;"Block def"
}
</code></pre></div></div>

<p>Just as Blocks may be defined with options, so too may hooks be defined with options. When the hook is rendered, these options will take a higher merge precedence than the options that were defined on the block itself. They will however take a lower merge precedence than any render items that were specified when the render call was made for the block being hooked (however, any of the reserved-keywords that are sent to the render call will have already been stripped out).</p>

<h2 id="with-a-partial">With a Partial</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">partial: </span><span class="s2">"some_partial"</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">partial: </span><span class="s2">"some_partial"</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">partial: </span><span class="s2">"some_partial"</span>
</code></pre></div></div>

<p>Hooks may also be defined with Rails partials using the “partial” keyword.</p>

<h2 id="with-a-proxy-to-another-block">With a Proxy to Another Block</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">with: :some_proxy_block</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">with: :some_proxy_block</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">with: :some_proxy_block</span>
</code></pre></div></div>

<p>Hooks may also be defined with a proxy to another block using the “with” keyword.</p>

          
            <h1 id="wrapping-blocks">Wrapping Blocks</h1>

<p>Wrappers work similarly to hooks with a few notable exceptions:</p>

<ol>
  <li>Wrappers are singular in nature. While there are three different wrappers that may be applied to a block, only one of each may be applied.</li>
  <li>They are defined directly on the block themselves or provided to the render call.</li>
</ol>

<p>Wrappers may be defined with either the name of another block, method, or a Proc. That block, method, or Proc must be prepared to take at least one argument, which is the content_block to call when the wrapper is ready to yield control to the content it is wrapping.</p>

<aside class="notice">
  Like hooks, wrappers will still render even if there is no associated block to be rendered.
</aside>

<h2 id="wrap_all-wrapper">“wrap_all” Wrapper</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_all</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="o">|</span> <span class="cp">%&gt;</span>
  Wrap All Start
  <span class="cp">&lt;%=</span> <span class="n">c</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;br&gt;</span>Wrap All End
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_each</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">o</span><span class="p">.</span><span class="nf">nil?</span><span class="p">;</span> <span class="n">o</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="n">i</span> <span class="o">=</span> <span class="kp">nil</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;br&gt;</span>Wrap Each Start <span class="cp">&lt;%=</span> <span class="n">i</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">c</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;br&gt;</span>Wrap Each End <span class="cp">&lt;%=</span> <span class="n">i</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around_all</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="o">|</span> <span class="cp">%&gt;</span>
  Around All Start<span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">c</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;br&gt;</span>Around All End<span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  content
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

With Collection:
<span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;br&gt;</span>
No Collection:
<span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="cp">%&gt;</span>

<span class="c">&lt;!-- OR --&gt;</span>
With Collection:
<span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;br&gt;</span>
No Collection:
<span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_all</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="o">|</span>
  Wrap All Start
  <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="nf">call</span>
  <span class="nt">%br</span>
  Wrap All End

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_each</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="o">|</span>
  <span class="p">-</span> <span class="k">if</span> <span class="n">o</span><span class="p">.</span><span class="nf">nil?</span><span class="p">;</span> <span class="n">o</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="n">i</span> <span class="o">=</span> <span class="kp">nil</span> <span class="k">end</span>
  <span class="nt">%br</span>
  Wrap Each Start
  <span class="p">=</span> <span class="n">i</span>
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="nf">call</span>
  <span class="nt">%br</span>
  Wrap Each End
  <span class="p">=</span> <span class="n">i</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around_all</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="o">|</span>
  Around All Start
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="nf">call</span>
  <span class="nt">%br</span>
  Around All End
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each</span> <span class="k">do</span>
  content

With Collection:
<span class="nt">%br</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]</span>
<span class="nt">%br</span>
No Collection:
<span class="nt">%br</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span>

<span class="nf">#-</span> OR
With Collection:
<span class="nt">%br</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]</span>
<span class="nt">%br</span>
No Collection:
<span class="nt">%br</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_all</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="o">|</span>
  <span class="s2">"Wrap All Start"</span> <span class="o">+</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s2">"&lt;br&gt;Wrap All End"</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_each</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="o">|</span>
  <span class="k">if</span> <span class="n">o</span><span class="p">.</span><span class="nf">nil?</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">i</span>
    <span class="n">i</span> <span class="o">=</span> <span class="kp">nil</span>
  <span class="k">end</span>
  <span class="s2">"&lt;br&gt;Wrap Each Start </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s2">"&lt;br&gt;Wrap Each End </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">around_all</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="o">|</span>
  <span class="s2">"Around All Start&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s2">"&lt;br&gt;Around All End&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each</span> <span class="k">do</span>
  <span class="s2">"content"</span>
<span class="k">end</span>

<span class="s2">"With Collection:&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">])</span> <span class="o">+</span>
<span class="s2">"&lt;br&gt;No Collection:&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="ss">:my_block</span><span class="p">)</span>

<span class="c1"># OR</span>
<span class="s2">"With Collection:&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">])</span> <span class="o">+</span>
<span class="s2">"&lt;br&gt;No Collection:&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>The above code will output the following:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>With Collection:
Around All Start
Wrap All Start
Wrap Each Start a
content
Wrap Each End a
Wrap Each Start b
content
Wrap Each End b
Wrap All End
Around All End

No Collection:
Around All Start
Wrap All Start
Wrap Each Start
content
Wrap Each End
Wrap All End
Around All End
</code></pre></div></div>

<p>“wrap_all” is a wrapper that surrounds content just inside any “around_all” hooks and around a potential “wrap_each” wrapper (or multiple “wrap_each” wrappers if rendering a collection).</p>

<h2 id="wrap_each-wrapper">“wrap_each” Wrapper</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_all</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="o">|</span> <span class="cp">%&gt;</span>
  Wrap All Start
  <span class="cp">&lt;%=</span> <span class="n">c</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;br&gt;</span>Wrap All End<span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_each</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">o</span><span class="p">.</span><span class="nf">nil?</span><span class="p">;</span> <span class="n">o</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="n">i</span> <span class="o">=</span> <span class="kp">nil</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;br&gt;</span>Wrap Each Start <span class="cp">&lt;%=</span> <span class="n">i</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">c</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;br&gt;</span>Wrap Each End <span class="cp">&lt;%=</span> <span class="n">i</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="o">|</span> <span class="cp">%&gt;</span>
  Around Start<span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">c</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;br&gt;</span>Around End
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  content
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

With Collection:
<span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;br&gt;</span>
No Collection:
<span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="cp">%&gt;</span>

<span class="c">&lt;!-- OR --&gt;</span>
With Collection:
<span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;br&gt;</span>
No Collection:
<span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_all</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="o">|</span>
  Wrap All Start
  <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="nf">call</span>
  <span class="nt">%br</span>
  Wrap All End
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_each</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="o">|</span>
  <span class="p">-</span> <span class="k">if</span> <span class="n">o</span><span class="p">.</span><span class="nf">nil?</span><span class="p">;</span> <span class="n">o</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="n">i</span> <span class="o">=</span> <span class="kp">nil</span> <span class="k">end</span>
  <span class="nt">%br</span>
  Wrap Each Start
  <span class="p">=</span> <span class="n">i</span>
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="nf">call</span>
  <span class="nt">%br</span>
  Wrap Each End
  <span class="p">=</span> <span class="n">i</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="o">|</span>
  Around Start
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="nf">call</span>
  <span class="nt">%br</span>
  Around End

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each</span> <span class="k">do</span>
  content

With Collection:
<span class="nt">%br</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]</span>
<span class="nt">%br</span>
No Collection:
<span class="nt">%br</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span>

<span class="nf">#-</span> OR
With Collection:
<span class="nt">%br</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]</span>
<span class="nt">%br</span>
No Collection:
<span class="nt">%br</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_all</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="o">|</span>
  <span class="s2">"Wrap All Start"</span> <span class="o">+</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s2">"&lt;br&gt;Wrap All End"</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_each</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="o">|</span>
  <span class="k">if</span> <span class="n">o</span><span class="p">.</span><span class="nf">nil?</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">i</span>
    <span class="n">i</span> <span class="o">=</span> <span class="kp">nil</span>
  <span class="k">end</span>
  <span class="s2">"&lt;br&gt;Wrap Each Start </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s2">"&lt;br&gt;Wrap Each End </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">around</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="o">|</span>
  <span class="s2">"Around Start&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s2">"&lt;br&gt;Around End"</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each</span> <span class="k">do</span>
  <span class="s2">"content"</span>
<span class="k">end</span>

<span class="s2">"With Collection:&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">])</span> <span class="o">+</span>
<span class="s2">"&lt;br&gt;No Collection:&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="ss">:my_block</span><span class="p">)</span>

<span class="c1"># OR</span>
<span class="s2">"With Collection:&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">])</span> <span class="o">+</span>
<span class="s2">"&lt;br&gt;No Collection:&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>The above code will output the following:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>With Collection:
Wrap All Start
Wrap Each Start a
Around Start
content
Around End
Wrap Each End a
Wrap Each Start b
Around Start
content
Around End
Wrap Each End b
Wrap All End

No Collection:
Wrap All Start
Wrap Each Start
Around Start
content
Around End
Wrap Each End
Wrap All End
</code></pre></div></div>

<p><em>Also aliased to “outer_wrapper”</em></p>

<p>When a collection is involved, the “wrap_each” wrapper will wrap each item in the collection with this wrapper, and all of these wrappers can be wrapped together using the “wrap_all” wrapper.</p>

<p>When no collection is involved, the “wrap_each” wrapper will simply act as another wrapper that can be wrapped within the “wrap_all” wrapper and just outside any “wrap_each” wrappers.</p>

<h2 id="wrap_with-wrapper">“wrap_with” Wrapper</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">i</span> <span class="o">=</span> <span class="kp">nil</span> <span class="k">if</span> <span class="n">i</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Blocks</span><span class="o">::</span><span class="no">RuntimeContext</span><span class="p">)</span> <span class="cp">%&gt;</span>
  Surround Start <span class="cp">&lt;%=</span> <span class="n">i</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">c</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;br&gt;</span>Surround End <span class="cp">&lt;%=</span> <span class="n">i</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_with</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">i</span> <span class="o">=</span> <span class="kp">nil</span> <span class="k">if</span> <span class="n">i</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Blocks</span><span class="o">::</span><span class="no">RuntimeContext</span><span class="p">)</span> <span class="cp">%&gt;</span>
  Wrap With Start <span class="cp">&lt;%=</span> <span class="n">i</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">c</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;br&gt;</span>Wrap Wrap End <span class="cp">&lt;%=</span> <span class="n">i</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">i</span> <span class="o">=</span> <span class="kp">nil</span> <span class="k">if</span> <span class="n">i</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Blocks</span><span class="o">::</span><span class="no">RuntimeContext</span><span class="p">)</span> <span class="cp">%&gt;</span>
  Before <span class="cp">&lt;%=</span> <span class="n">i</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">i</span> <span class="o">=</span> <span class="kp">nil</span> <span class="k">if</span> <span class="n">i</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Blocks</span><span class="o">::</span><span class="no">RuntimeContext</span><span class="p">)</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;br&gt;</span>After <span class="cp">&lt;%=</span> <span class="n">i</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_with: :wrap_with</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  content
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

With Collection:
<span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;br&gt;</span>
No Collection:
<span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="cp">%&gt;</span>

<span class="c">&lt;!-- OR --&gt;</span>
With Collection:
<span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_with: :wrap_with</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;br&gt;</span>
No Collection:
<span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_with: :wrap_with</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span>
  <span class="p">-</span> <span class="n">i</span> <span class="o">=</span> <span class="kp">nil</span> <span class="k">if</span> <span class="n">i</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Blocks</span><span class="o">::</span><span class="no">RuntimeContext</span><span class="p">)</span>
  Surround Start
  <span class="p">=</span> <span class="n">i</span>
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="nf">call</span>
  <span class="nt">%br</span>
  Surround End
  <span class="p">=</span> <span class="n">i</span>


<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_with</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span>
  <span class="p">-</span> <span class="n">i</span> <span class="o">=</span> <span class="kp">nil</span> <span class="k">if</span> <span class="n">i</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Blocks</span><span class="o">::</span><span class="no">RuntimeContext</span><span class="p">)</span>
  Wrap With Start
  <span class="p">=</span> <span class="n">i</span>
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="nf">call</span>
  <span class="nt">%br</span>
  Wrap Wrap End
  <span class="p">=</span> <span class="n">i</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
  <span class="p">-</span> <span class="n">i</span> <span class="o">=</span> <span class="kp">nil</span> <span class="k">if</span> <span class="n">i</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Blocks</span><span class="o">::</span><span class="no">RuntimeContext</span><span class="p">)</span>
  Before
  <span class="p">=</span> <span class="n">i</span>
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
  <span class="p">-</span> <span class="n">i</span> <span class="o">=</span> <span class="kp">nil</span> <span class="k">if</span> <span class="n">i</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Blocks</span><span class="o">::</span><span class="no">RuntimeContext</span><span class="p">)</span>
  <span class="nt">%br</span>
  After
  <span class="p">=</span> <span class="n">i</span>
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_with: :wrap_with</span> <span class="k">do</span>
  content

With Collection:
<span class="nt">%br</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]</span>
<span class="nt">%br</span>
No Collection:
<span class="nt">%br</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span>

<span class="c">-# OR
</span>With Collection:
<span class="nt">%br</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_with: :wrap_with</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]</span>
<span class="nt">%br</span>
No Collection:
<span class="nt">%br</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_with: :wrap_with</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">surround</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span>
  <span class="n">i</span> <span class="o">=</span> <span class="kp">nil</span> <span class="k">if</span> <span class="n">i</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Blocks</span><span class="o">::</span><span class="no">RuntimeContext</span><span class="p">)</span>
  <span class="s2">"Surround Start </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s2">"&lt;br&gt;Surround End </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_with</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span>
  <span class="n">i</span> <span class="o">=</span> <span class="kp">nil</span> <span class="k">if</span> <span class="n">i</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Blocks</span><span class="o">::</span><span class="no">RuntimeContext</span><span class="p">)</span>
  <span class="s2">"Wrap With Start </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s2">"&lt;br&gt;Wrap Wrap End </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
  <span class="n">i</span> <span class="o">=</span> <span class="kp">nil</span> <span class="k">if</span> <span class="n">i</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Blocks</span><span class="o">::</span><span class="no">RuntimeContext</span><span class="p">)</span>
  <span class="s2">"Before </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
  <span class="n">i</span> <span class="o">=</span> <span class="kp">nil</span> <span class="k">if</span> <span class="n">i</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Blocks</span><span class="o">::</span><span class="no">RuntimeContext</span><span class="p">)</span>
  <span class="s2">"&lt;br&gt;After </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_with: :wrap_with</span> <span class="k">do</span>
  <span class="s2">"content"</span>
<span class="k">end</span>

<span class="s2">"With Collection:&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_with: :wrap_with</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">])</span> <span class="o">+</span>
<span class="s2">"&lt;br&gt;No Collection:&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_with: :wrap_with</span><span class="p">)</span>

<span class="c1"># OR</span>
<span class="s2">"With Collection:&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_with: :wrap_with</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">])</span> <span class="o">+</span>
<span class="s2">"&lt;br&gt;No Collection:&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_with: :wrap_with</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>The above code will output the following:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>With Collection:
Before a
Wrap With Start a
Surround Start a
content
Surround End a
Wrap Wrap End a
After a
Before b
Wrap With Start b
Surround Start b
content
Surround End b
Wrap Wrap End b
After b

No Collection:
Before
Wrap With Start
Surround Start
content
Surround End
Wrap Wrap End
After
</code></pre></div></div>

<p><em>Also aliased to “wrap”, “wrapper”, and “inner_wrapper”</em></p>

<p>The “wrap_with” wrapper is preceded by “before” hooks, followed by “after” hooks, surrounded by “around” hooks, and wraps around “surround” hooks.</p>

<h2 id="defining-a-wrapper-with-a-proc">Defining a wrapper with a Proc</h2>

<p>Wrappers can also be defined with Procs. The Proc must take, at a minimum, the content_block that they are wrapping, as the first argument. They may optionally take the options hash as their second argument.</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">wrapper</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrapper: </span><span class="n">wrapper</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  Hello
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">wrapper</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="nt">%div</span><span class="p">=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span>
<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrapper: </span><span class="n">wrapper</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  Hello
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">wrapper</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">content_tag</span> <span class="ss">:div</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrapper: </span><span class="n">wrapper</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s2">"Hello"</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>The above code will output the following</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div&gt;</span>Hello<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

          
            <h1 id="skipping-blocks">Skipping Blocks</h1>

<blockquote>
  <p>Prerequisite code for below examples:</p>
</blockquote>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all_wrapper</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each_wrapper</span><span class="p">,</span>
  <span class="ss">wrap_with: :wrap_with_wrapper</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  My Block
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:proxy_block</span> <span class="k">do</span> <span class="o">|*</span><span class="n">args</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">options</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">extract_options!</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">item</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">shift</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrapper</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">options</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">extract_options!</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">item</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">shift</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span> <span class="cp">%&gt;</span> Before
  <span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span> <span class="cp">%&gt;</span> After
  <span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_all_wrapper</span><span class="p">,</span>
  <span class="ss">name: </span><span class="s2">"wrap_all Wrapper"</span><span class="p">,</span>
  <span class="ss">with: :wrapper</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_each_wrapper</span><span class="p">,</span>
  <span class="ss">name: </span><span class="s2">"wrap_each Wrapper"</span><span class="p">,</span>
  <span class="ss">with: :wrapper</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_with_wrapper</span><span class="p">,</span>
  <span class="ss">name: </span><span class="s2">"wrap_with Wrapper"</span><span class="p">,</span>
  <span class="ss">with: :wrapper</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="p">[</span><span class="ss">:before_all</span><span class="p">,</span>
    <span class="ss">:before</span><span class="p">,</span>
    <span class="ss">:prepend</span><span class="p">,</span>
    <span class="ss">:append</span><span class="p">,</span>
    <span class="ss">:after</span><span class="p">,</span>
    <span class="ss">:after_all</span><span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">hook</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span>
      <span class="ss">:my_block</span><span class="p">,</span>
      <span class="ss">with: :proxy_block</span><span class="p">,</span>
      <span class="ss">name: </span><span class="s2">"</span><span class="se">\"</span><span class="si">#{</span><span class="n">hook</span><span class="si">}</span><span class="se">\"</span><span class="s2"> Hook"</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="p">[</span><span class="ss">:around_all</span><span class="p">,</span>
    <span class="ss">:around</span><span class="p">,</span>
    <span class="ss">:surround</span><span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">hook</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span>
      <span class="ss">:my_block</span><span class="p">,</span>
      <span class="ss">with: :wrapper</span><span class="p">,</span>
      <span class="ss">name: </span><span class="s2">"</span><span class="se">\"</span><span class="si">#{</span><span class="n">hook</span><span class="si">}</span><span class="se">\"</span><span class="s2"> Hook"</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all_wrapper</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each_wrapper</span><span class="p">,</span>
  <span class="ss">wrap_with: :wrap_with_wrapper</span> <span class="k">do</span>
  My Block
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:proxy_block</span> <span class="k">do</span> <span class="o">|*</span><span class="n">args</span><span class="o">|</span>
  <span class="p">-</span> <span class="n">options</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">extract_options!</span>
  <span class="p">-</span> <span class="n">item</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">shift</span>
  <span class="p">=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrapper</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="o">|</span>
  <span class="p">-</span> <span class="n">options</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">extract_options!</span>
  <span class="p">-</span> <span class="n">item</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">shift</span>
  <span class="p">=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
  Before
  <span class="nt">%br</span>
  <span class="p">=</span> <span class="n">b</span><span class="p">.</span><span class="nf">call</span>
  <span class="p">=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
  After
  <span class="nt">%br</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_all_wrapper</span><span class="p">,</span>
  <span class="ss">name: </span><span class="s2">"wrap_all Wrapper"</span><span class="p">,</span>
  <span class="ss">with: :wrapper</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_each_wrapper</span><span class="p">,</span>
  <span class="ss">name: </span><span class="s2">"wrap_each Wrapper"</span><span class="p">,</span>
  <span class="ss">with: :wrapper</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_with_wrapper</span><span class="p">,</span>
  <span class="ss">name: </span><span class="s2">"wrap_with Wrapper"</span><span class="p">,</span>
  <span class="ss">with: :wrapper</span>

<span class="p">-</span> <span class="p">[</span><span class="ss">:before_all</span><span class="p">,</span>
   <span class="ss">:before</span><span class="p">,</span>
   <span class="ss">:prepend</span><span class="p">,</span>
   <span class="ss">:append</span><span class="p">,</span>
   <span class="ss">:after</span><span class="p">,</span>
   <span class="ss">:after_all</span><span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">hook</span><span class="o">|</span>
  <span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span>
      <span class="ss">:my_block</span><span class="p">,</span>
      <span class="ss">with: :proxy_block</span><span class="p">,</span>
      <span class="ss">name: </span><span class="s2">"</span><span class="se">\"</span><span class="si">#{</span><span class="n">hook</span><span class="si">}</span><span class="se">\"</span><span class="s2"> Hook"</span><span class="p">)</span>

<span class="p">-</span> <span class="p">[</span><span class="ss">:around_all</span><span class="p">,</span>
   <span class="ss">:around</span><span class="p">,</span>
   <span class="ss">:surround</span><span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">hook</span><span class="o">|</span>
  <span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span>
      <span class="ss">:my_block</span><span class="p">,</span>
      <span class="ss">with: :wrapper</span><span class="p">,</span>
      <span class="ss">name: </span><span class="s2">"</span><span class="se">\"</span><span class="si">#{</span><span class="n">hook</span><span class="si">}</span><span class="se">\"</span><span class="s2"> Hook"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrap_all: :wrap_all_wrapper</span><span class="p">,</span>
  <span class="ss">wrap_each: :wrap_each_wrapper</span><span class="p">,</span>
  <span class="ss">wrap_with: :wrap_with_wrapper</span> <span class="k">do</span>
  <span class="s2">"My Block&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:proxy_block</span> <span class="k">do</span> <span class="o">|*</span><span class="n">args</span><span class="o">|</span>
  <span class="n">options</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">extract_options!</span>
  <span class="n">item</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">shift</span>
  <span class="s2">"</span><span class="si">#{</span><span class="n">options</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrapper</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="o">|</span>
  <span class="n">options</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">extract_options!</span>
  <span class="n">item</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">shift</span>
  <span class="s2">"</span><span class="si">#{</span><span class="n">options</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span><span class="si">}</span><span class="s2"> Before&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
  <span class="n">b</span><span class="p">.</span><span class="nf">call</span> <span class="o">+</span>
  <span class="s2">"</span><span class="si">#{</span><span class="n">options</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span><span class="si">}</span><span class="s2"> After&lt;br&gt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span>
<span class="k">end</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_all_wrapper</span><span class="p">,</span>
  <span class="ss">name: </span><span class="s2">"wrap_all Wrapper"</span><span class="p">,</span>
  <span class="ss">with: :wrapper</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_each_wrapper</span><span class="p">,</span>
  <span class="ss">name: </span><span class="s2">"wrap_each Wrapper"</span><span class="p">,</span>
  <span class="ss">with: :wrapper</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:wrap_with_wrapper</span><span class="p">,</span>
  <span class="ss">name: </span><span class="s2">"wrap_with Wrapper"</span><span class="p">,</span>
  <span class="ss">with: :wrapper</span>

<span class="p">[</span><span class="ss">:before_all</span><span class="p">,</span>
 <span class="ss">:before</span><span class="p">,</span>
 <span class="ss">:prepend</span><span class="p">,</span>
 <span class="ss">:append</span><span class="p">,</span>
 <span class="ss">:after</span><span class="p">,</span>
 <span class="ss">:after_all</span><span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">hook</span><span class="o">|</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span>
    <span class="ss">:my_block</span><span class="p">,</span>
    <span class="ss">with: :proxy_block</span><span class="p">,</span>
    <span class="ss">name: </span><span class="s2">"</span><span class="se">\"</span><span class="si">#{</span><span class="n">hook</span><span class="si">}</span><span class="se">\"</span><span class="s2"> Hook"</span><span class="p">)</span>
<span class="k">end</span>

<span class="p">[</span><span class="ss">:around_all</span><span class="p">,</span>
 <span class="ss">:around</span><span class="p">,</span>
 <span class="ss">:surround</span><span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">hook</span><span class="o">|</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span>
    <span class="ss">:my_block</span><span class="p">,</span>
    <span class="ss">with: :wrapper</span><span class="p">,</span>
    <span class="ss">name: </span><span class="s2">"</span><span class="se">\"</span><span class="si">#{</span><span class="n">hook</span><span class="si">}</span><span class="se">\"</span><span class="s2"> Hook"</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Blocks may be skipped from rendering, such that whenever a render call occurs, no content will be rendered.</p>

<aside class="notice">
  The code to the right is prerequesite code to the "Skipping Blocks" examples that follow
</aside>

<p>Skips come in two forms: skipping a block only, and skipping a block with all of its hooks and wrappers.</p>

<h2 id="skipping-the-block-only">Skipping the Block Only</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h2&gt;</span>Render Before Skip:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">skip</span> <span class="ss">:my_block</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h2&gt;</span>Render After Skip:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">%h2</span> Render Before Skip:
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">skip</span> <span class="ss">:my_block</span>
<span class="nt">%h2</span> Render After Skip:
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">output</span> <span class="o">=</span>
  <span class="s2">"&lt;h2&gt;Render Before Skip:&lt;/h2&gt;"</span><span class="p">.</span>
    <span class="nf">html_safe</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">skip</span> <span class="ss">:my_block</span>
<span class="n">output</span> <span class="o">+=</span>
  <span class="s2">"&lt;h2&gt;Render After Skip:&lt;/h2&gt;"</span><span class="p">.</span>
    <span class="nf">html_safe</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span>
<span class="n">output</span>
</code></pre></div></div>

<blockquote>
  <p>The above code will output the following:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Render Before Skip:

"before_all" Hook
"around_all" Hook Before
wrap_all Wrapper Before
wrap_each Wrapper Before
"around" Hook Before
"before" Hook
wrap_with Wrapper Before
"surround" Hook Before
"prepend" Hook
My Block
"append" Hook
"surround" Hook After
wrap_with Wrapper After
"after" Hook
"around" Hook After
wrap_each Wrapper After
wrap_all Wrapper After
"around_all" Hook After
"after_all" Hook

Render After Skip:

"before_all" Hook
"around_all" Hook Before
wrap_all Wrapper Before
wrap_each Wrapper Before
"around" Hook Before
"before" Hook
"after" Hook
"around" Hook After
wrap_each Wrapper After
wrap_all Wrapper After
"around_all" Hook After
"after_all" Hook
</code></pre></div></div>

<p>A block may be skipped using the #skip method.</p>

<p>Calling #skip has the effect of skipping rendering of the block itself, and any “prepend” hooks, “append” hooks, “surround” hooks, and the “wrap_with” wrapper that might have been associated with the block being skipped.</p>

<p>Any “before” hooks, “before_all” hooks, “after” hooks, “after_all” hooks, “around” hooks, “around_all” hooks, the “wrap_all” wrapper, and the “wrap_each” wrapper will continue to be rendered when the block is skipped. See <a href="#Skipping the Block and its Hooks">Skipping the Block and its Hooks</a> for skipping everything.</p>

<h3 id="with-a-collection">With a Collection</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>Render Before Skip:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">skip</span> <span class="ss">:my_block</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h2&gt;</span>Render After Skip:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:my_block</span><span class="p">,</span>
    <span class="ss">collection: </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]</span>

<span class="nt">%h2</span> Render Before Skip:
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span>

<span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">skip</span> <span class="ss">:my_block</span>
<span class="nt">%h2</span> Render After Skip:
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">output</span> <span class="o">=</span>
  <span class="s2">"&lt;h2&gt;Render Before Skip:&lt;/h2&gt;"</span><span class="p">.</span>
    <span class="nf">html_safe</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">skip</span> <span class="ss">:my_block</span>
<span class="n">output</span> <span class="o">+=</span>
  <span class="s2">"&lt;h2&gt;Render After Skip:&lt;/h2&gt;"</span><span class="p">.</span>
    <span class="nf">html_safe</span> <span class="o">+</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span>
<span class="n">output</span>
</code></pre></div></div>

<blockquote>
  <p>The above code will output the following:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Render Before Skip:

"before_all" Hook
"around_all" Hook Before
wrap_all Wrapper Before
wrap_each Wrapper Before for item "a"
"around" Hook Before for item "a"
"before" Hook for item "a"
wrap_with Wrapper Before for item "a"
"surround" Hook Before for item "a"
"prepend" Hook for item "a"
My Block
"append" Hook for item "a"
"surround" Hook After for item "a"
wrap_with Wrapper After for item "a"
"after" Hook for item "a"
"around" Hook After for item "a"
wrap_each Wrapper After for item "a"
wrap_each Wrapper Before for item "b"
"around" Hook Before for item "b"
"before" Hook for item "b"
wrap_with Wrapper Before for item "b"
"surround" Hook Before for item "b"
"prepend" Hook for item "b"
My Block
"append" Hook for item "b"
"surround" Hook After for item "b"
wrap_with Wrapper After for item "b"
"after" Hook for item "b"
"around" Hook After for item "b"
wrap_each Wrapper After for item "b"
wrap_all Wrapper After
"around_all" Hook After
"after_all" Hook

Render After Skip:

"before_all" Hook
"around_all" Hook Before
wrap_all Wrapper Before
wrap_each Wrapper Before for item "a"
"around" Hook Before for item "a"
"before" Hook for item "a"
"after" Hook for item "a"
"around" Hook After for item "a"
wrap_each Wrapper After for item "a"
wrap_each Wrapper Before for item "b"
"around" Hook Before for item "b"
"before" Hook for item "b"
"after" Hook for item "b"
"around" Hook After for item "b"
wrap_each Wrapper After for item "b"
wrap_all Wrapper After
"around_all" Hook After
"after_all" Hook
</code></pre></div></div>

<p>A block with a collection can also be skipped, though the resulting output may not be desired.</p>

<p>Calling #skip on a block with a collection has the effect of skipping rendering of the block itself, and any “prepend” hooks, “append” hooks, “surround” hooks, and the “wrap_with” wrapper that might have been associated with the block being skipped.</p>

<p>Any “before” hooks, “before_all” hooks, “after” hooks, “after_all” hooks, “around” hooks, “around_all” hooks, the “wrap_all” wrapper, and the “wrap_each” wrapper will continue to be rendered when the block is skipped. All the hooks and wrappers, with the exception of the “around_all”, “wrap_all”, “before_all”, and “after_all” ones, will be rendered for each item in the collection (this behavior will likely change in a future release of Blocks).</p>

<p>See <a href="#Skipping the Block and its Hooks">Skipping the Block and its Hooks</a> for skipping everything.</p>

<h2 id="skipping-the-block-and-its-hooks">Skipping the Block and its Hooks</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">skip_completely</span> <span class="ss">:my_block</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  Hello
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">skip_completely</span> <span class="ss">:my_block</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  Hello
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># where builder is an instance</span>
<span class="c1">#  of Blocks::Builder</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">skip_completely</span> <span class="ss">:my_block</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span> <span class="k">do</span>
  <span class="s2">"Hello"</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>There will be no output from the above command</p>
</blockquote>

<p>Because calling #skip can still have the effect of rendering some of the hooks and wrappers for a particular block (before, after, around, before_all, after_all, wrap_all, wrap_each will still be rendered), there is the need for a second type of skip, called #skip_completely, which will skip the block and all associated hooks and wrappers.</p>

          
            <h1 id="reserved-keywords">Reserved Keywords</h1>

<p>Whether defining a block, defining options for a block, rendering a block, registering hooks for a block, configuring global options for Blocks, or initializing an instance of a Blocks::Builder, there are certain keywords which are reserved for specific purposes:</p>

<h2 id="collection-and-as-and-object-and-current_index">“collection” and “as” and “object” and “current_index”</h2>

<p>“collection” is used to designate a collection for a block. When the block is rendered, it will be rendered for each item in the collection, and the “collection” option will be extracted from the options hash.</p>

<p>“as” is used to give each item in the collection an alias as it is being iterated over. “as” will default to “object”, meaning that “object” becomes a reserved keyword by default. If “as” is set to some other value, whatever that value is will become a reserved keyword for that block.</p>

<p>“current_index” will be a zero-based index of the current item’s position within the collection.</p>

<h2 id="with">“with”</h2>

<p>“with” is used to specify the proxy render strategy, where its value is name of the other block to be rendered in its place.</p>

<h2 id="partial">“partial”</h2>

<p>“partial” is used to specify the Rails partial render strategy, where its value is the Rails partial to render.</p>

<h3 id="other-reserved-keywords-when-using-a-partial">Other Reserved Keywords when using a partial</h3>

<p>http://www.rubymagic.org/posts/ruby-and-rails-reserved-words</p>

<h2 id="block">“block”</h2>

<p>“block” can be used to specify the Ruby block render strategy, where its value is the Ruby block to render. This is an alternative to specifying the block using the “do … end” syntax.</p>

<h2 id="defaults">“defaults”</h2>

<p>“defaults”, if specified, must have its value be a hash. These represent default options, which are given a lower precedence than standard options when merging options.</p>

<h2 id="runtime">“runtime”</h2>

<p>“runtime”, if specified, must have its value be a hash. These represent runtime options, which are given a higher precedence than standard options when merging options.</p>

<h2 id="builder-and-builder_variable">“builder” and “builder_variable”</h2>

<p>“builder” will be the default variable name given to the instance of the Blocks::Builder passed to a partial that triggered the call to render to the possible. The “builder” can be used to invoke Blocks functionality within the partial on a shared instance of a Blocks::Builder.</p>

<p>The name “builder” can be overridden by specifying a value in “builder_variable”.</p>

<h2 id="wrappers">Wrappers</h2>

<h3 id="wrap_all">“wrap_all”</h3>

<p>Indicates that a wrapper will wrap around any wrap_each wrappers.</p>

<h3 id="wrap_each--outer_wrapper">“wrap_each” / “outer_wrapper”</h3>

<p>Indicates that a wrapper will wrap around a block and any around, before, after, surround, prepend, and append hooks for that block.</p>

<h3 id="wrap_with--wrap--wrapper--inner_wrapper">“wrap_with” / “wrap” / “wrapper” / “inner_wrapper”</h3>

<p>Indicates that a wrapper will wrap around a block and any surround, prepend, and append hooks for that block.</p>

<h2 id="parent_runtime_context">“parent_runtime_context”</h2>

<p>Passed internally within the Blocks gem as a parent Blocks::RuntimeContext when calculating the Blocks::RuntimeContext for a hook or wrapper for a block.</p>

          
            <h1 id="helper-blocks">Helper Blocks</h1>

<p>Blocks comes with some prebuilt utility blocks to aid in your development efforts.</p>

<h2 id="the-content_tag-block">The :content_tag Block</h2>

<blockquote>
  <p>According to Bootstrap’s documentation, a standard card has the following markup:</p>
</blockquote>

<p>The :content_tag block is more or less a direct wrapper around <a href="https://apidock.com/rails/ActionView/Helpers/TagHelper/content_tag">ActionView’s content_tag method</a>.
However, by defining it as a block, it may be used in several useful ways.</p>

<h3 id="as-the-definition-for-a-block">As the definition for a block</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">with: :content_tag</span><span class="p">,</span> <span class="ss">tag: :h1</span><span class="p">,</span> <span class="ss">html: </span><span class="p">{</span> <span class="ss">style: </span><span class="s2">"color: red"</span> <span class="p">}</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:title</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  My Title
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">with: :content_tag</span><span class="p">,</span> <span class="ss">tag: :h1</span><span class="p">,</span> <span class="ss">html: </span><span class="p">{</span> <span class="ss">style: </span><span class="s2">"color: red"</span> <span class="p">}</span>
<span class="p">=</span> <span class="n">blocks</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:title</span> <span class="k">do</span>
  My Title
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">builder</span> <span class="o">=</span> <span class="no">Blocks</span><span class="o">::</span><span class="no">Builder</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">view_context</span><span class="p">)</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">with: :content_tag</span><span class="p">,</span> <span class="ss">tag: :h1</span><span class="p">,</span> <span class="ss">html: </span><span class="p">{</span> <span class="ss">style: </span><span class="s2">"color: red"</span> <span class="p">}</span>
<span class="c1"># Since no overrides block is provided, this</span>
<span class="c1">#  call is synonymous with:</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:title</span> <span class="k">do</span>
  <span class="s2">"My Title"</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>The output from running the code will be:</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;h1</span> <span class="na">style=</span><span class="s">"color: red"</span><span class="nt">&gt;</span>
  My Title
<span class="nt">&lt;/h1&gt;</span></code></pre></div>

<p>When used as the definition for a block (using the with keyword), you may choose to specify the tag to use or any html options to be applied to the tag.
Then, you can either provide the definition a block of its own or supply as a render option when calling render.</p>

<h3 id="as-a-wrapper-or-a-surrounding-hook-for-a-block">As a wrapper or a surrounding hook for a block</h3>


          
            <h1 id="templating">Templating</h1>

<blockquote>
  <p>Sample Syntax</p>
</blockquote>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">render_with_overrides</span> <span class="ss">partial:
  </span><span class="s2">"PATH_TO_PARTIAL"</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="c">&lt;!-- Perform overrides here
        using the builder.
        Whatever happens here
        happens first. --&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">=</span> <span class="n">render_with_overrides</span> <span class="ss">partial: </span><span class="s2">"PATH_TO_PARTIAL"</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="nf">#-</span> Perform overrides here using the builder.
  <span class="nf">#-</span> Whatever happens here happens first.
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">builder</span> <span class="o">=</span> <span class="no">Blocks</span><span class="o">::</span><span class="no">Builder</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">view_context</span><span class="p">)</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">partial:
  </span><span class="s2">"PATH_TO_PARTIAL"</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span>
  <span class="c1"># Perform overrides here</span>
  <span class="c1">#  using the builder.</span>
  <span class="c1">#  Whatever happens here</span>
  <span class="c1">#  happens first.</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Templating is one of the most powerful concepts within the Blocks gem. It is the bedrock on which reusable UI components can be built.</p>

<p>A template is nothing more than a Rails partial (in future releases, this concept will likely expand to Ruby blocks as well) that has a reference to an instance of a Blocks::Builder object, and uses it to invoke Blocks functionality. It may consist of multiple block definitions, block render calls, block wrappers and hooks, and other content.</p>

<p>By default, a Blocks::Builder instance will be passed in as a variable called “builder”, but this can be overridden by specifying the “builder_variable” option. When rendering this template, it should produce either a standard / default definition for your template or a sample output of your template complete with dummy data.</p>

<aside class="warning">
  This functionality can be invoked on an existing instance of a Blocks::Builder, but this should be done with caution, as all block definitions will share a namespace. For this reason, it is usually best to invoke the functionality on a new instance of a Blocks::Builder.
</aside>

<p>However, this standard / default / sample definition can be overridden at runtime with an overrides block that will execute before the template is rendered by the code that is rendering the template.</p>

<p>There are two ways to invoke this functionality, either using the #render_with_overrides method (also aliased as #with_template) that is injected into ActionView as a helper method, or by calling #render_with_overrides on an existing or new instance of a Blocks::Builder.</p>

<p><img src="/blocks/images/templating.png" /></p>

<h2 id="building-a-bootstrap-4-card">Building a Bootstrap 4 Card</h2>

<blockquote>
  <p>According to Bootstrap’s documentation, a standard card has the following markup:</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card"</span> <span class="na">style=</span><span class="s">"width: 20rem;"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"card-img-top"</span> <span class="na">src=</span><span class="s">"..."</span> <span class="na">alt=</span><span class="s">"Card image cap"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-block"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">"card-title"</span><span class="nt">&gt;</span>Card title<span class="nt">&lt;/h4&gt;</span>
    <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"card-text"</span><span class="nt">&gt;</span>
      Some quick example text
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>Go somewhere<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>Templating is best demonstrated through example. In the following set of iterative examples, a template for rendering a <a href="https://v4-alpha.getbootstrap.com/components/card/">Bootstrap 4 Card</a> will be defined and expanded upon with Blocks functionality.</p>

<h3 id="creating-a-template">Creating a Template</h3>

<blockquote>
  <p>The following code would be added to a new file located at /app/views/shared/_card.html.erb:</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card"</span> <span class="na">style=</span><span class="s">"width: 20rem;"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"card-img-top"</span> <span class="na">src=</span><span class="s">"..."</span> <span class="na">alt=</span><span class="s">"Card image cap"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-block"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">"card-title"</span><span class="nt">&gt;</span>Card title<span class="nt">&lt;/h4&gt;</span>
      <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"card-text"</span><span class="nt">&gt;</span>
        Some quick example text
      <span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>Go somewhere<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card</span> <span class="cp">%&gt;</span></code></pre></div>

<blockquote>
  <p>Now, when the template is rendered, it will match the markup above exactly.</p>
</blockquote>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">render_with_overrides</span> <span class="ss">partial: </span><span class="s2">"shared/card"</span> <span class="cp">%&gt;</span>
<span class="c">&lt;!-- Since no overrides block is provided, this
     call is synonymous with: --&gt;</span>
<span class="cp">&lt;%=</span> <span class="no">Blocks</span><span class="o">::</span><span class="no">Builder</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">self</span><span class="p">).</span><span class="nf">render</span><span class="p">(</span><span class="ss">partial: </span><span class="s2">"shared/card"</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">=</span> <span class="n">render_with_overrides</span> <span class="ss">partial: </span><span class="s2">"shared/card"</span>
<span class="nf">#-</span> Since no overrides block is provided, this
<span class="nf">#-</span>  call is synonymous with:
<span class="p">=</span> <span class="no">Blocks</span><span class="o">::</span><span class="no">Builder</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">self</span><span class="p">).</span><span class="nf">render</span><span class="p">(</span><span class="ss">partial: </span><span class="s2">"shared/card"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">builder</span> <span class="o">=</span> <span class="no">Blocks</span><span class="o">::</span><span class="no">Builder</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">view_context</span><span class="p">)</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">partial: </span><span class="s2">"shared/card"</span>
<span class="c1"># Since no overrides block is provided, this</span>
<span class="c1">#  call is synonymous with:</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">partial: </span><span class="s2">"shared/card"</span>
</code></pre></div></div>

<p>Setting up a Template is simple. Simply create a Rails partial. That’s the bare minimum that needs to be done, although an empty partial won’t do anything useful.</p>

<p>In this example, we define a block called :card and then render it using the “builder” variable that is automatically defined within the partial.</p>

<p>Our output will match the sample markup above but that is because we have hardcoded the markup within the :card block definition. We’ll need to make the block definitions more dynamic but before we do that, we should extract out more block definitions.</p>

<h3 id="extracting-out-block-definitions">Extracting Out Block Definitions</h3>

<blockquote>
  <p>/app/views/shared/_card.html.erb:</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card"</span> <span class="na">style=</span><span class="s">"width: 20rem;"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_image</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_content</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_image</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"card-img-top"</span> <span class="na">src=</span><span class="s">"..."</span> <span class="na">alt=</span><span class="s">"Card image cap"</span><span class="nt">&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_block</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-block"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_title</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_text</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_action</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_title</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">"card-title"</span><span class="nt">&gt;</span>Card title<span class="nt">&lt;/h4&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_text</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"card-text"</span><span class="nt">&gt;</span>
    Some quick example text
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_action</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>Go somewhere<span class="nt">&lt;/a&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_content</span><span class="p">,</span>
  <span class="ss">with: :card_block</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card</span> <span class="cp">%&gt;</span></code></pre></div>

<blockquote>
  <p>The output from rendering this template will be the same as before</p>
</blockquote>

<p>If you look at the sample markup for a card, hopefully you notice a pattern. It’s something like this:</p>

<ul>
  <li>A Card is an element with an associated CSS class and is made up of a card image and card content
    <ul>
      <li>A Card image is an image tag with an associated CSS class and an image path</li>
      <li>Card Content is an element with an associated CSS class and is made up of a card title, card text, and a card action
        <ul>
          <li>A Card title is a h4 tag with an associated CSS class and text for the title</li>
          <li>Card text is a p tag with an associated CSS class and text</li>
          <li>A Card Action is a link button with associated CSS classes, a label for the button, and a path for the action.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>While not every Bootstrap 4 card will follow this exact pattern, it is a good starting point for beginning to break down a card into pieces.</p>

<p>The code to the right defines the card element and breaks the main :card block into its two components: :card_image and :card_content.</p>

<p>The :card_image block renders the hardcoded image tag and the :card_content block sets itself up to proxy to the :card_block block. This is done in anticipation (based on having read ahead in the Bootstrap 4 Card documentation) of using something other than a card-block for the content of the card (more on this shortly).</p>

<h3 id="extracting-out-the-wrappers">Extracting out the Wrappers</h3>

<blockquote>
  <p>/app/views/shared/_card.html.erb:</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:block_wrapper</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">wrapper_tag: :div</span><span class="p">,</span>
    <span class="ss">wrapper_html: </span><span class="p">{},</span>
    <span class="ss">wrapper_option: :wrapper_html</span>
  <span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">block</span><span class="p">,</span> <span class="n">options</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">content_tag</span> <span class="n">options</span><span class="p">[</span><span class="ss">:wrapper_tag</span><span class="p">],</span>
    <span class="n">options</span><span class="p">[</span><span class="n">options</span><span class="p">[</span><span class="ss">:wrapper_option</span><span class="p">]],</span>
    <span class="o">&amp;</span><span class="n">block</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card</span><span class="p">,</span>
  <span class="ss">wrapper: :block_wrapper</span><span class="p">,</span>
  <span class="ss">wrapper_option: :card_html</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">card_html: </span><span class="p">{</span> <span class="ss">class: </span><span class="s2">"card"</span> <span class="p">},</span>
  <span class="p">}</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_image</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_content</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_image</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"card-img-top"</span> <span class="na">src=</span><span class="s">"..."</span> <span class="na">alt=</span><span class="s">"Card image cap"</span><span class="nt">&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_block</span><span class="p">,</span>
  <span class="ss">wrapper: :block_wrapper</span><span class="p">,</span>
  <span class="ss">wrapper_option: :card_content_html</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">card_content_html: </span><span class="p">{</span>
      <span class="ss">class: </span><span class="s2">"card-block"</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_title</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_text</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_action</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_title</span><span class="p">,</span>
  <span class="ss">wrapper: :block_wrapper</span><span class="p">,</span>
  <span class="ss">wrapper_option: :card_title_html</span><span class="p">,</span>
  <span class="ss">wrapper_tag: :h4</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">card_title_html: </span><span class="p">{</span>
      <span class="ss">class: </span><span class="s2">"card-title"</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  Card title
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_text</span><span class="p">,</span>
  <span class="ss">wrapper: :block_wrapper</span><span class="p">,</span>
  <span class="ss">wrapper_option: :card_text_html</span><span class="p">,</span>
  <span class="ss">wrapper_tag: :p</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">card_text_html: </span><span class="p">{</span> <span class="ss">class: </span><span class="s2">"card-text"</span> <span class="p">}</span>
  <span class="p">}</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  Some quick example text
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_action</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>Go somewhere<span class="nt">&lt;/a&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_content</span><span class="p">,</span>
  <span class="ss">with: :card_block</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card</span> <span class="cp">%&gt;</span></code></pre></div>

<blockquote>
  <p>The output from rendering this template will be the same as before</p>
</blockquote>

<p>Perhaps it will also be noticed that every block defined renders an HTML element with nested content. This code is ripe for extraction into a common wrapper block.</p>

<p>In the code to the right, this is exactly what is happening. A new block is defined called :block_wrapper. The :block_wrapper block is setup to take a content_block as its first argument, which will automatically be passed in when :block_wrapper is used as a wrapper for another block. :block_wrapper also defines a couple default options, such as :wrapper_tag being set to :div, :wrapper_html being set to an empty hash, and :wrapper_option being set to :wrapper_html. These options are all used within the :block_wrapper definition, where it builds an HTML element around the content_block. The element will be the :wrapper_tag option type and have attributes specified by the option specified by the :wrapper_option option, which will be :wrapper_html by default.</p>

<p>Because all of :block_wrapper’s options are default options, they are easily overridden by the block being wrapper. For example, the :card block sets wrapper to :block_wrapper and its :wrapper_option to :card_html. Then it sets its default options for :card_html to { class: “card” }. By setting :card_html as a default option for :card, it can easily be overridden by the “render_with_overrides” call that will be demonstrated shortly.</p>

<aside class="notice">Notice that :card did not need to declare it's :wrapper_tag as :div since it is already being defaulted to :div by :block_wrapper</aside>

<p>:card_block, :card_title, and :card_text each follow the same paradigm. Notice that :card_text overrides the :wrapper_tag to :p and :card_title overrides it to :h4.</p>

<aside class="notice">This paradigm of using a block wrapper that wraps a block within an HTML element is so common, that Blocks provides a similar block by default called :content_tag (purposely named to match the ActionView method). If this automatically defined block is used instead, the code to the right would only need to change by removing the :block_wrapper definition and changing all references of :block_wrapper to :content_tag.</aside>

<aside class="notice">The only two blocks that are not using the :block_wrapper are :card_image and :card_action. While both could utilize the :block_wrapper wrapper, it makes more sense not to do so. This will enable us to utilize Rails' link_to and image_tag helper methods instead, since links and images need a bit more fine-tuning than regular HTML elements.</aside>

<h3 id="making-the-blocks-more-dynamic">Making the Blocks more Dynamic</h3>

<blockquote>
  <p>/app/views/shared/_card.html.erb:</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:block_wrapper</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">wrapper_tag: :div</span><span class="p">,</span>
    <span class="ss">wrapper_html: </span><span class="p">{},</span>
    <span class="ss">wrapper_option: :wrapper_html</span>
  <span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">block</span><span class="p">,</span> <span class="n">options</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">content_tag</span> <span class="n">options</span><span class="p">[</span><span class="ss">:wrapper_tag</span><span class="p">],</span>
    <span class="n">options</span><span class="p">[</span><span class="n">options</span><span class="p">[</span><span class="ss">:wrapper_option</span><span class="p">]],</span>
    <span class="o">&amp;</span><span class="n">block</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card</span><span class="p">,</span>
  <span class="ss">wrapper: :block_wrapper</span><span class="p">,</span>
  <span class="ss">wrapper_option: :card_html</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">card_html: </span><span class="p">{</span> <span class="ss">class: </span><span class="s2">"card"</span> <span class="p">},</span>
  <span class="p">}</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_image</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_content</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_image</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">card_image: </span><span class="s2">"placeholder.jpg"</span><span class="p">,</span>
    <span class="ss">card_image_html: </span><span class="p">{</span> <span class="ss">class: </span><span class="s2">"card-img-top"</span> <span class="p">}</span>
  <span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="n">options</span><span class="p">[</span><span class="ss">:card_image</span><span class="p">],</span>
    <span class="n">options</span><span class="p">[</span><span class="ss">:card_image_html</span><span class="p">]</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_block</span><span class="p">,</span>
  <span class="ss">wrapper: :block_wrapper</span><span class="p">,</span>
  <span class="ss">wrapper_option: :card_block_html</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">card_block_html: </span><span class="p">{</span>
      <span class="ss">class: </span><span class="s2">"card-block"</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_title</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_text</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_action</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_title</span><span class="p">,</span>
  <span class="ss">wrapper: :block_wrapper</span><span class="p">,</span>
  <span class="ss">wrapper_option: :card_title_html</span><span class="p">,</span>
  <span class="ss">wrapper_tag: :h4</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">card_title_html: </span><span class="p">{</span>
      <span class="ss">class: </span><span class="s2">"card-title"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="ss">card_title: </span><span class="s2">"Card title"</span>
  <span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:card_title</span><span class="p">]</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_text</span><span class="p">,</span>
  <span class="ss">wrapper: :block_wrapper</span><span class="p">,</span>
  <span class="ss">wrapper_option: :card_text_html</span><span class="p">,</span>
  <span class="ss">wrapper_tag: :p</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">card_text_html: </span><span class="p">{</span> <span class="ss">class: </span><span class="s2">"card-text"</span> <span class="p">},</span>
    <span class="ss">card_text: </span><span class="s2">"Some quick example text"</span>
  <span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:card_text</span><span class="p">]</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_action</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">card_action_path: </span><span class="s1">'#'</span><span class="p">,</span>
    <span class="ss">card_action_text: </span><span class="s1">'Go somewhere'</span><span class="p">,</span>
    <span class="ss">card_action_html: </span><span class="p">{</span> <span class="ss">class: </span><span class="s2">"btn btn-primary"</span> <span class="p">}</span>
  <span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">options</span><span class="p">[</span><span class="ss">:card_action_text</span><span class="p">],</span>
    <span class="n">options</span><span class="p">[</span><span class="ss">:card_action_path</span><span class="p">],</span>
    <span class="n">options</span><span class="p">[</span><span class="ss">:card_action_html</span><span class="p">]</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_content</span><span class="p">,</span>
  <span class="ss">with: :card_block</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card</span> <span class="cp">%&gt;</span></code></pre></div>

<blockquote>
  <p>The output from rendering this template will be the same as before</p>
</blockquote>

<p>To round out the Bootstrap 4 Card template, we now specify each block definition that requires dynamic content in it’s definition to take the options hash as a parameter. Any hardcoded context is then moved into the defaults hash for that block as an option and the Blocks gem will take. Where the hardcoded content previously was, we can now replace with dynamic code that utilizes the options hash that is passed in.</p>

<p>Now we have a more or less complete template (though lacking in several features described in the Bootstrap 4 documentation) for rendering and customizing Bootstrap 4 Cards.</p>

<h3 id="rendering-the-template-with-option-overrides">Rendering the Template with Option Overrides</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">render_with_overrides</span> <span class="ss">partial: </span><span class="s2">"shared/card"</span><span class="p">,</span>
  <span class="ss">card_html: </span><span class="p">{</span> <span class="ss">id: </span><span class="s2">"my-card"</span> <span class="p">},</span>
  <span class="ss">card_action_text: </span><span class="s2">"Go"</span><span class="p">,</span>
  <span class="ss">card_action_html: </span><span class="p">{</span> <span class="ss">class: </span><span class="s2">"btn btn-danger"</span> <span class="p">},</span>
  <span class="ss">card_title: </span><span class="s2">"My Title"</span><span class="p">,</span>
  <span class="ss">card_text: </span><span class="s2">"My Text"</span><span class="p">,</span>
  <span class="ss">card_action_path: </span><span class="s1">'http://mobilecause.com'</span><span class="p">,</span>
  <span class="ss">card_image: </span><span class="s2">"my-image.png"</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">=</span> <span class="n">render_with_overrides</span> <span class="ss">partial: </span><span class="s2">"shared/card"</span><span class="p">,</span>
  <span class="ss">card_html: </span><span class="p">{</span> <span class="ss">id: </span><span class="s2">"my-card"</span> <span class="p">},</span>
  <span class="ss">card_action_text: </span><span class="s2">"Go"</span><span class="p">,</span>
  <span class="ss">card_action_html: </span><span class="p">{</span> <span class="ss">class: </span><span class="s2">"btn btn-danger"</span> <span class="p">},</span>
  <span class="ss">card_title: </span><span class="s2">"My Title"</span><span class="p">,</span>
  <span class="ss">card_text: </span><span class="s2">"My Text"</span><span class="p">,</span>
  <span class="ss">card_action_path: </span><span class="s1">'http://mobilecause.com'</span><span class="p">,</span>
  <span class="ss">card_image: </span><span class="s2">"my-image.png"</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">builder</span> <span class="o">=</span> <span class="no">Blocks</span><span class="o">::</span><span class="no">Builder</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">view_context</span><span class="p">,</span>
  <span class="ss">card_html: </span><span class="p">{</span> <span class="ss">id: </span><span class="s2">"my-card"</span> <span class="p">},</span>
  <span class="ss">card_action_text: </span><span class="s2">"Go"</span><span class="p">,</span>
  <span class="ss">card_action_html: </span><span class="p">{</span> <span class="ss">class: </span><span class="s2">"btn btn-danger"</span> <span class="p">},</span>
  <span class="ss">card_title: </span><span class="s2">"My Title"</span><span class="p">,</span>
  <span class="ss">card_text: </span><span class="s2">"My Text"</span><span class="p">,</span>
  <span class="ss">card_action_path: </span><span class="s1">'http://mobilecause.com'</span><span class="p">,</span>
  <span class="ss">card_image: </span><span class="s2">"my-image.png"</span><span class="p">)</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">partial: </span><span class="s2">"shared/card"</span>
</code></pre></div></div>

<blockquote>
  <p>The above code will output the following:</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card"</span> <span class="na">id=</span><span class="s">"my-card"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"card-img-top"</span>
    <span class="na">src=</span><span class="s">"/images/my-image.png"</span>
    <span class="na">alt=</span><span class="s">"My image"</span> <span class="nt">/&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-block"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">"card-title"</span><span class="nt">&gt;</span>
      My Title
    <span class="nt">&lt;/h4&gt;</span>
    <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"card-text"</span><span class="nt">&gt;</span>
      My Text
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn btn-danger"</span>
      <span class="na">href=</span><span class="s">"http://mobilecause.com"</span><span class="nt">&gt;</span>
      Go
    <span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>Now that the template is defined, we can start rendering it with actual overrides. Since many of the blocks had some of their options defined as defaults, they can easily be overridden by the render_with_overrides options.</p>

<aside class="warning">
  When calling the #render_with_overrides helper method from the view, any options that are passed in when automatically be passed to a new instance of a Blocks::Builder as init options. Therefore, if you're the one initializing the Blocks::Builder object (as is demonstrated in the Ruby example to the right), the options will need to be specified to the Blocks::Builder#new method instead of to the subsequent render_with_overrides call on the Blocks::Builder instance. This will likely be fixed in future releases.
</aside>

<aside class="notice">
  Notice also that the wrapper div maintained both the default class and the provided style. This is because the card_html options were deep merged and there was no clash in keys.
</aside>

<h3 id="rendering-the-template-with-block-overrides">Rendering the Template with Block Overrides</h3>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">render_with_overrides</span> <span class="ss">partial:
  </span><span class="s2">"shared/card"</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card</span> <span class="k">do</span> <span class="cp">%&gt;</span>
    I am a complete replacement for the card
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">render_with_overrides</span> <span class="ss">partial:
  </span><span class="s2">"shared/card"</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="c">&lt;%# Change card_title's tag to h2 %&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_title</span><span class="p">,</span>
    <span class="ss">wrapper_tag: :h2</span><span class="p">,</span>
    <span class="ss">card_title: </span><span class="s2">"I had my wrapper tag changed"</span> <span class="cp">%&gt;</span>

  <span class="c">&lt;%# Change card_action's definition completely %&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_action</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">"alert('clicked');"</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:card_action_text</span><span class="p">]</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/button&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="c">&lt;%# turn off card_text's wrapper %&gt;</span>
  <span class="c">&lt;%#  and change it's definition %&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_text</span><span class="p">,</span> <span class="ss">wrapper: </span><span class="kp">nil</span> <span class="k">do</span> <span class="cp">%&gt;</span>
    This is custom card text.
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">=</span> <span class="n">render_with_overrides</span> <span class="ss">partial: </span><span class="s2">"shared/card"</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span>
  <span class="p">-</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card</span> <span class="k">do</span>
    I am a complete replacement for the card

<span class="p">=</span> <span class="n">render_with_overrides</span> <span class="ss">partial: </span><span class="s2">"shared/card"</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span>
  <span class="c">-# Change card_title's tag to h2
</span>  <span class="p">-</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_title</span><span class="p">,</span>
    <span class="ss">wrapper_tag: :h2</span><span class="p">,</span>
    <span class="ss">card_title: </span><span class="s2">"I had my wrapper tag changed"</span>

  <span class="c">-# Change card_action's definition completely
</span>  <span class="p">-</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_action</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span>
    <span class="nt">%button</span><span class="p">{</span><span class="ss">onclick: </span><span class="s2">"alert('clicked');"</span><span class="p">}</span>
      <span class="p">=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:card_action_text</span><span class="p">]</span>
  <span class="c">-# turn off card_text's wrapper
</span>  <span class="c">-#  and change it's definition
</span>  <span class="p">-</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_text</span><span class="p">,</span>
    <span class="ss">wrapper: </span><span class="kp">nil</span> <span class="k">do</span>
    This is custom card text.
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">builder</span> <span class="o">=</span> <span class="no">Blocks</span><span class="o">::</span><span class="no">Builder</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">view_context</span><span class="p">)</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">partial:
  </span><span class="s2">"shared/card"</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card</span> <span class="k">do</span>
    <span class="s2">"I am a complete replacement for the card"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">builder</span> <span class="o">=</span> <span class="no">Blocks</span><span class="o">::</span><span class="no">Builder</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">view_context</span><span class="p">)</span>
<span class="n">text2</span> <span class="o">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">partial:
  </span><span class="s2">"shared/card"</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span>
  <span class="c1"># Change card_title's tag to h2</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_title</span><span class="p">,</span>
    <span class="ss">wrapper_tag: :h2</span><span class="p">,</span>
    <span class="ss">card_title: </span><span class="s2">"I had my wrapper tag changed"</span>

  <span class="c1"># Change card_action's definition completely</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_action</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span>
    <span class="sx">%%"&lt;button onclick='alert('clicked');'&gt;
      #{options[:card_action_text]}
    &lt;/button&gt;%</span><span class="p">.</span><span class="nf">html_safe</span>
  <span class="k">end</span>
  <span class="c1"># turn off card_text's wrapper</span>
  <span class="c1">#  and change it's definition</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_text</span><span class="p">,</span> <span class="ss">wrapper: </span><span class="kp">nil</span> <span class="k">do</span>
    <span class="s2">"This is custom card text."</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">text</span> <span class="o">+</span> <span class="n">text2</span>
</code></pre></div></div>

<blockquote>
  <p>The above code will output the following:</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card"</span><span class="nt">&gt;</span>
  I am a complete replacement for the card
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"card-img-top"</span>
    <span class="na">src=</span><span class="s">"/assets/placeholder.jpg"</span>
    <span class="na">alt=</span><span class="s">"Placeholder"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-block"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"card-title"</span><span class="nt">&gt;</span>
      I had my wrapper tag changed
    <span class="nt">&lt;/h2&gt;</span>
    This is custom card text.
    <span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">"alert('clicked');"</span><span class="nt">&gt;</span>
      Go somewhere
    <span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>Finding the option overrides aren’t enough? There’s always block overrides. Any block defined within the template can be overridden by an overrides block that executes before the template is rendered.</p>

<h3 id="hooking-and-skipping-template-definitions">Hooking and Skipping Template Definitions</h3>

<blockquote>
  <p>The following code would be added to /app/views/shared/_card.html.erb, just before the builder.render :card call:</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_subtitle</span><span class="p">,</span>
  <span class="ss">wrapper: :block_wrapper</span><span class="p">,</span>
  <span class="ss">wrapper_option: :card_subtitle_html</span><span class="p">,</span>
  <span class="ss">wrapper_tag: :h6</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">card_subtitle_html: </span><span class="p">{</span>
      <span class="ss">class: </span><span class="s2">"card-subtitle mb-2 text-muted"</span>
    <span class="p">},</span>
    <span class="ss">card_subtitle: </span><span class="s2">"Card subtitle"</span>
  <span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:card_subtitle</span><span class="p">]</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_list_group</span><span class="p">,</span>
  <span class="ss">wrapper: :block_wrapper</span><span class="p">,</span>
  <span class="ss">wrapper_option: :card_list_group_html</span><span class="p">,</span>
  <span class="ss">wrapper_tag: :ul</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">card_list_group_html: </span><span class="p">{</span>
      <span class="ss">class: </span><span class="s2">"list-group list-group-flush"</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_list_group_item</span><span class="p">,</span>
  <span class="ss">wrapper: :block_wrapper</span><span class="p">,</span>
  <span class="ss">wrapper_option: :card_list_group_item_html</span><span class="p">,</span>
  <span class="ss">wrapper_tag: :li</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">card_list_group_item_html: </span><span class="p">{</span>
      <span class="ss">class: </span><span class="s2">"list-group-item"</span>
    <span class="p">},</span>
    <span class="ss">card_list_group_item: </span><span class="s2">"Item"</span>
  <span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:card_list_group_item</span><span class="p">]</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_header</span><span class="p">,</span>
  <span class="ss">wrapper: :block_wrapper</span><span class="p">,</span>
  <span class="ss">wrapper_option: :card_header_html</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">card_header_html: </span><span class="p">{</span>
      <span class="ss">class: </span><span class="s2">"card-header"</span>
    <span class="p">},</span>
    <span class="ss">card_header: </span><span class="s2">"Card Header"</span>
  <span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:card_header</span><span class="p">]</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_footer</span><span class="p">,</span>
  <span class="ss">wrapper: :block_wrapper</span><span class="p">,</span>
  <span class="ss">wrapper_option: :card_footer_html</span><span class="p">,</span>
  <span class="ss">defaults: </span><span class="p">{</span>
    <span class="ss">card_footer_html: </span><span class="p">{</span>
      <span class="ss">class: </span><span class="s2">"card-footer"</span>
    <span class="p">},</span>
    <span class="ss">card_footer: </span><span class="s2">"Card Footer"</span>
  <span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:card_footer</span><span class="p">]</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span></code></pre></div>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">render_with_overrides</span> <span class="ss">partial:
  </span><span class="s2">"shared/card"</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">skip</span> <span class="ss">:card_image</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:card_title</span> <span class="k">do</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_subtitle</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">prepend</span> <span class="ss">:card</span> <span class="k">do</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_header</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">append</span> <span class="ss">:card</span> <span class="k">do</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_footer</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_content</span><span class="p">,</span>
    <span class="ss">with: :card_list_group</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">append</span> <span class="ss">:card_content</span> <span class="k">do</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_list_group_item</span><span class="p">,</span>
      <span class="ss">card_list_group_item: </span><span class="s2">"Item 1"</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

  <span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">prepend</span> <span class="ss">:card_content</span> <span class="k">do</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_list_group_item</span><span class="p">,</span>
      <span class="ss">card_list_group_item: </span><span class="s2">"Item 0"</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">=</span> <span class="n">render_with_overrides</span> <span class="ss">partial: </span><span class="s2">"shared/card"</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span>
  <span class="p">-</span> <span class="n">builder</span><span class="p">.</span><span class="nf">skip</span> <span class="ss">:card_image</span>
  <span class="p">-</span> <span class="n">builder</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:card_title</span> <span class="k">do</span>
    <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_subtitle</span>
  <span class="p">-</span> <span class="n">builder</span><span class="p">.</span><span class="nf">prepend</span> <span class="ss">:card</span> <span class="k">do</span>
    <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_header</span>
  <span class="p">-</span> <span class="n">builder</span><span class="p">.</span><span class="nf">append</span> <span class="ss">:card</span> <span class="k">do</span>
    <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_footer</span>
  <span class="p">-</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_content</span><span class="p">,</span>
    <span class="ss">with: :card_list_group</span>
  <span class="p">-</span> <span class="n">builder</span><span class="p">.</span><span class="nf">append</span> <span class="ss">:card_content</span> <span class="k">do</span>
    <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_list_group_item</span><span class="p">,</span>
      <span class="ss">card_list_group_item: </span><span class="s2">"Item 1"</span>
  <span class="p">-</span> <span class="n">builder</span><span class="p">.</span><span class="nf">prepend</span> <span class="ss">:card_content</span> <span class="k">do</span>
    <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_list_group_item</span><span class="p">,</span>
      <span class="ss">card_list_group_item: </span><span class="s2">"Item 0"</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">builder</span> <span class="o">=</span> <span class="no">Blocks</span><span class="o">::</span><span class="no">Builder</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">view_context</span><span class="p">)</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">partial:
  </span><span class="s2">"shared/card"</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">skip</span> <span class="ss">:card_image</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:card_title</span> <span class="k">do</span>
    <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_subtitle</span>
  <span class="k">end</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">prepend</span> <span class="ss">:card</span> <span class="k">do</span>
    <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_header</span>
  <span class="k">end</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">append</span> <span class="ss">:card</span> <span class="k">do</span>
    <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_footer</span>
  <span class="k">end</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_content</span><span class="p">,</span>
    <span class="ss">with: :card_list_group</span>
  <span class="n">builder</span><span class="p">.</span><span class="nf">append</span> <span class="ss">:card_content</span> <span class="k">do</span>
    <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_list_group_item</span><span class="p">,</span>
      <span class="ss">card_list_group_item: </span><span class="s2">"Item 1"</span>
  <span class="k">end</span>

  <span class="n">builder</span><span class="p">.</span><span class="nf">prepend</span> <span class="ss">:card_content</span> <span class="k">do</span>
    <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_list_group_item</span><span class="p">,</span>
      <span class="ss">card_list_group_item: </span><span class="s2">"Item 0"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>The above code will output the following:</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-header"</span><span class="nt">&gt;</span>
    Card Header
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"list-group list-group-flush"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"list-group-item"</span><span class="nt">&gt;</span>
      Item 0
    <span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"list-group-item"</span><span class="nt">&gt;</span>
      Item 1
    <span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-footer"</span><span class="nt">&gt;</span>
    Card Footer
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>
<p>Scanning through the Bootstrap 4 Cards documentation, it can be plainly observed that the current card template only scratches the surface of available features for cards. In the code to the right, a few of these features are added to the template: :card_subtitle, :card_list_group with :card_list_group_item’s, :card_header, and :card_footer. Though all of these features are defined as blocks, none of them are actually used by default. This is actually a good approach, in that these additional features can be added or swapped in as desired while the default output will be unaffected.</p>

<p>We also have access to the full arsenal of hooks, wrapper with relation to the various block definitions within the template. We can also skip blocks or replace the definitions with new definitions.</p>

<h3 id="extending-the-template">Extending the Template</h3>

<blockquote>
  <p>Assume the following partial exists in /app/views/shared/_team_card.html.erb:</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">partial:
  </span><span class="s2">"shared/card"</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_title</span><span class="p">,</span>
    <span class="ss">card_title: </span><span class="n">team</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_text</span><span class="p">,</span>
    <span class="ss">card_text: </span><span class="n">team</span><span class="p">.</span><span class="nf">description</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:card_action</span><span class="p">,</span>
    <span class="ss">card_action_text: </span><span class="s1">'Donate'</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span></code></pre></div>

<blockquote>
  <p>Then when the following code runs:</p>
</blockquote>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">team</span> <span class="o">=</span> <span class="no">OpenStruct</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
  <span class="ss">name: </span><span class="s2">"Andrew's Campaign"</span><span class="p">,</span>
  <span class="ss">npo: </span><span class="s2">"Innogive"</span><span class="p">,</span>
  <span class="ss">description: </span><span class="s2">"Donate money"</span>
<span class="p">)</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render_with_overrides</span> <span class="ss">partial:
  </span><span class="s2">"shared/team_card"</span><span class="p">,</span>
  <span class="ss">team: </span><span class="n">team</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">builder</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:card_title</span><span class="p">,</span>
    <span class="ss">with: :card_subtitle</span><span class="p">,</span>
    <span class="ss">card_subtitle: </span><span class="n">team</span><span class="p">.</span><span class="nf">npo</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">team</span> <span class="o">=</span> <span class="no">OpenStruct</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Andrew's Campaign"</span><span class="p">,</span>
  <span class="ss">npo: </span><span class="s2">"Innogive"</span><span class="p">,</span>
  <span class="ss">description: </span><span class="s2">"Donate money"</span><span class="p">)</span>
<span class="p">=</span> <span class="n">render_with_overrides</span> <span class="ss">partial: </span><span class="s2">"shared/team_card"</span><span class="p">,</span>
  <span class="ss">team: </span><span class="n">team</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span>
  <span class="p">-</span> <span class="n">builder</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:card_title</span> <span class="k">do</span>
    <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_subtitle</span><span class="p">,</span>
      <span class="ss">card_subtitle: </span><span class="n">team</span><span class="p">.</span><span class="nf">npo</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">team</span> <span class="o">=</span> <span class="no">OpenStruct</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
  <span class="ss">name: </span><span class="s2">"Andrew's Campaign"</span><span class="p">,</span>
  <span class="ss">npo: </span><span class="s2">"Innogive"</span><span class="p">,</span>
  <span class="ss">description: </span><span class="s2">"Donate money"</span>
<span class="p">)</span>
<span class="n">builder</span> <span class="o">=</span> <span class="no">Blocks</span><span class="o">::</span><span class="no">Builder</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">view_context</span><span class="p">)</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">partial:
  </span><span class="s2">"shared/team_card"</span><span class="p">,</span>
  <span class="ss">team: </span><span class="n">team</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span>
    <span class="n">builder</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:card_title</span> <span class="k">do</span>
      <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:card_subtitle</span><span class="p">,</span>
        <span class="ss">card_subtitle: </span><span class="n">team</span><span class="p">.</span><span class="nf">npo</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>It will produce the following output:</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"card-img-top"</span>
    <span class="na">src=</span><span class="s">"/assets/placeholder.jpg"</span>
    <span class="na">alt=</span><span class="s">"Placeholder"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-block"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">"card-title"</span><span class="nt">&gt;</span>
      Andrew's Campaign
    <span class="nt">&lt;/h4&gt;</span>
    <span class="nt">&lt;h6</span> <span class="na">class=</span><span class="s">"card-subtitle mb-2 text-muted"</span><span class="nt">&gt;</span>
      Innogive
    <span class="nt">&lt;/h6&gt;</span>
    <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"card-text"</span><span class="nt">&gt;</span>
      Donate money
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>
      Donate
    <span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>Templates may also be extended to form new templates, which may also be extended as many times as necessary.</p>

<p>An example might be create new templates that render different versions of a card. For example, maybe one type of card is detailed, while another is an overview. Or maybe one type of card displays information about a team and another about an organization. Or maybe one is meant for conveying information on a dashboard while the other in meant purely for frontend pages. Perhaps then the dashboard card template could be extended multiple times as well to represent different types of objects that may be displayed on the dashboard.</p>

<p>In the example to the right, a team-specific version of card is created as a template. Code then renders this new template with some overrides of if its own. The overrides have been kept very basic in order to clearly demonstrate how to setup a template that extends another template.</p>

<aside class="warning">
  Take note that with the team_card template, builder.render is used instead of render_with_overrides. This is forcing the two templates to render using the same Blocks::Builder instance, i.e. to share a Blocks namespace. This is what allows the overrides block for the team_card template to affect the defaults in card template.
</aside>

          
            <h1 id="configuration">Configuration</h1>

<p>Blocks is customized by adding an initializer to config/initializers directory called blocks.rb.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Blocks.configure do |config|
  # Configuration code goes here
end</code></pre></div>

<h2 id="configuring-global-options">Configuring Global Options</h2>

<p>Global Options are merged into the set of options generated when rendering a block or hook or wrapper for a block. They are given the lowest precedence when merging options.</p>

<h3 id="global-runtime-options">Global Runtime Options</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>Blocks.configure do |config|
  config.
    set_global_options runtime: {
      a: 1, b: 2
    }
end</code></pre></div>

<h3 id="global-standard-options">Global Standard Options</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>Blocks.configure do |config|
  config.
    set_global_options a: 1, b: 2
end</code></pre></div>

<h3 id="global-default-options">Global Default Options</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>Blocks.configure do |config|
  config.
    set_global_options defaults: {
      a: 1, b: 2
    }
end</code></pre></div>

<h2 id="configuring-caller-id">Configuring Caller ID</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>Blocks.configure do |config|
  config.lookup_caller_location = true
end</code></pre></div>

<p>Caller ID is a debugging feature that is turned off by default, and should really only ever be turned on in Development mode and perhaps Test mode. It is enabled by running the configuration code to the right. Setting this flag to true will noticeably affect the execution speed of page rendering. This is because for every option that is added to a Block, a Proxy to a Block, or when rendering a block, the code will figure out what line of code triggered the setting of that option.</p>

<h2 id="configuring-the-builder-class">Configuring the Builder Class</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>Blocks.configure do |config|
  config.builder_class = LayoutBuilder
end</code></pre></div>

<p>The Builder Class is Blocks::Builder by default, but can be changed to something else using this configuration option. Whatever it is changed to, the new class should be a subclass of Blocks::Builder. Configuring the Builder Class is useful when you want to add in block definitions or shared functionality for the entire application.</p>

          
            <h1 id="custom-builders">Custom Builders</h1>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyCustomBuilder</span> <span class="o">&lt;</span> <span class="no">Blocks</span><span class="p">.</span><span class="nf">builder_class</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{})</span>
    <span class="k">super</span> <span class="n">view</span><span class="p">,</span> <span class="n">options</span>

    <span class="c1"># Additional initialization /</span>
    <span class="c1">#  block definitions could happen here</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1"># From a controller action:</span>
<span class="n">builder</span> <span class="o">=</span> <span class="no">MyCustomBuilder</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">view_context</span><span class="p">)</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:some_block</span> <span class="k">do</span>
  <span class="s2">"Hello"</span>
<span class="k">end</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:some_block</span></code></pre></div>

<blockquote>
  <p>This will output “Hello”</p>
</blockquote>

<p>Blocks::Builder is the main class for storing information about block definitions and their corresponding hooks and wrappers.</p>

<p>Wherever a Block is defined, or a hook is registered for a Block, or a block is skipped, or a Block is rendered, all actions will be executed on an instance of Blocks::Builder.</p>

<p>When the “blocks” keyword is called from the view for the first time, it will instantiate a new instance of a Blocks::Builder (or a subclass of Blocks::Builder if the Blocks.builder_class is configured to something else - <a href="#configuring-the-builder-class">See Configuring the Builder Class</a>).</p>

<p>A custom builder is just a subclass of Blocks::Builder. Instead of extending the Blocks::Builder class directly though, it is usually better to extend Blocks.builder_class (which will be Blocks::Builder unless it has been configured to something else). The one general exception to this rule is on the class that is configured to be the Blocks.builder_class - this should extend Blocks::Builder directly.</p>

<p>If #initialize is overridden in the subclass, it must, at a minimum call super with a reference to the view or view_context, and optionally, the init options hash.</p>

<h2 id="custom-builders-with-helper-methods">Custom Builders with Helper Methods</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyCustomBuilder</span> <span class="o">&lt;</span> <span class="no">Blocks</span><span class="p">.</span><span class="nf">builder_class</span>
  <span class="k">def</span> <span class="nf">tag</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">extract_options!</span>

    <span class="n">wrapper_html</span> <span class="o">=</span> <span class="k">if</span> <span class="n">options</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Blocks</span><span class="o">::</span><span class="no">RuntimeContext</span><span class="p">)</span>
      <span class="n">wrapper_option</span> <span class="o">=</span>
        <span class="n">options</span><span class="p">[</span><span class="ss">:wrapper_option</span><span class="p">]</span> <span class="o">||</span> <span class="ss">:wrapper_html</span>
      <span class="n">options</span><span class="p">[</span><span class="n">wrapper_option</span><span class="p">]</span> <span class="o">||</span> <span class="p">{}</span>
    <span class="k">else</span>
      <span class="n">options</span>
    <span class="k">end</span>

    <span class="n">wrapper_tag</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:wrapper_tag</span><span class="p">]</span>
    <span class="k">if</span> <span class="o">!</span><span class="n">wrapper_tag</span>
      <span class="n">first_arg</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">first</span>
      <span class="n">wrapper_tag</span> <span class="o">=</span> <span class="k">if</span> <span class="n">first_arg</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">String</span><span class="p">)</span> <span class="o">||</span> <span class="n">first_arg</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Symbol</span><span class="p">)</span>
        <span class="n">first_arg</span>
      <span class="k">else</span>
        <span class="ss">:div</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">content_tag</span> <span class="n">wrapper_tag</span><span class="p">,</span> <span class="n">wrapper_html</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">builder</span> <span class="o">=</span> <span class="no">MyCustomBuilder</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrapper: :tag</span><span class="p">,</span>
  <span class="ss">wrapper_tag: :h2</span><span class="p">,</span>
  <span class="ss">wrapper_html: </span><span class="p">{</span> <span class="ss">class: </span><span class="s1">'text-muted'</span> <span class="p">}</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  Hello
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="c">&lt;!-- OR --&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">tag</span> <span class="ss">:h2</span><span class="p">,</span> <span class="ss">class: </span><span class="s1">'text-muted'</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  Hello
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> <span class="n">builder</span> <span class="o">=</span> <span class="no">MyCustomBuilder</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
<span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrapper: :tag</span><span class="p">,</span>
  <span class="ss">wrapper_tag: :h2</span><span class="p">,</span>
  <span class="ss">wrapper_html: </span><span class="p">{</span> <span class="ss">class: </span><span class="s1">'text-muted'</span> <span class="p">}</span> <span class="k">do</span>
  Hello

<span class="nf">#-</span> OR

<span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">tag</span> <span class="ss">:h2</span><span class="p">,</span> <span class="ss">class: </span><span class="s1">'text-muted'</span> <span class="k">do</span>
  Hello
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">builder</span> <span class="o">=</span> <span class="no">MyCustomBuilder</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">render</span> <span class="ss">:my_block</span><span class="p">,</span>
  <span class="ss">wrapper: :block_wrapper</span><span class="p">,</span>
  <span class="ss">wrapper_tag: :h2</span><span class="p">,</span>
  <span class="ss">wrapper_html: </span><span class="p">{</span> <span class="ss">class: </span><span class="s1">'text-muted'</span> <span class="p">}</span> <span class="k">do</span>
  <span class="s2">"Hello"</span>
<span class="k">end</span>

<span class="c1"># OR</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">tag</span> <span class="ss">:h2</span><span class="p">,</span> <span class="ss">class: </span><span class="s1">'text-muted'</span> <span class="k">do</span>
  <span class="s2">"Hello"</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>This will produce the following output:</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">'text-muted'</span><span class="nt">&gt;</span>Hello<span class="nt">&lt;/h2&gt;</span>
</code></pre></div></div>

<p>One of the primary reasons one might want to create a custom builder is to provide helper methods that are isolated within the builder. These helper methods may be invoked directly on the builder object, or indirectly by using a proxy or hook or wrapper.</p>

<p>In the example to the right, tag is declared as a method (which is almost a direct port over of the “block_wrapper” block defined in the <a href="#extracting-out-the-wrappers">Templating Example for Bootstrap Cards</a> it was defined as a Block). The code has been slightly modified to allow the method to be called directly from the builder, or indirectly as a wrapper or hook for a Block.</p>

<aside class="notice">
  At this time, it is not possible to proxy to a builder method (by using the "with" keyword) that expects / allows a block as an argument (i.e. this wouldn't be possible: 'builder.render with: :tag do "Hello" end'. This will likely change in future versions).
</aside>

<aside class="notice">
  If the method is called indirectly, either because it is registered as a hook or wrapper for a block, the options hash that is sent in to the method will be an instance of a Blocks::RuntimeContext. If the method is called directly on the builder, the options hash will be whatever is directly passed in or default to an empty hash.
</aside>

          
            <h1 id="acknowledgements">Acknowledgements</h1>

<p>The <a href="http://github.com/hunterae/blocks">blocks gem</a> was written and is maintained by <a href="http://github.com/hunterae">Andrew Hunter</a>.</p>

<p>If you think this looks somewhat familiar, there’s good reason for that. Any similarities you may notice with <a href="http://api.rubyonrails.org/classes/ActionView/Helpers/CaptureHelper.html#method-i-content_for">Rails’s content_for with yield</a> and <a href="https://apidock.com/rails/ActionController/Base/render">rendering partials in Rails</a> are intentional (the proxying feature may even remind you of <a href="http://ruby-doc.org/stdlib-2.0.0/libdoc/forwardable/rdoc/Forwardable.html">Ruby’s Forwardable Module</a>). Part of the original reasoning for the creating this gem was to provide a common interface for rendering both Ruby blocks and Rails’ partials.</p>

<p>Special thanks to the following people for helping advance this gem and its corresponding documentation forward:</p>

<ul>
  <li><a href="https://github.com/taf2">Todd Fisher</a> - For helping me visualize and create the initial inception of this gem back in 2011 and understand how Ruby blocks work</li>
  <li><a href="https://github.com/elguapo1611">Jon Phillips</a> - For helping me work out syntax and use cases for the Blocks gem</li>
  <li><a href="https://www.livingsocial.com/">Various people and teams at LivingSocial</a> - For allowing and believing in me to run with an experimental and unproven technology to help my gem start to take shape into what it is today.</li>
  <li><a href="https://www.mobilecause.com/">Various people at MobileCause</a> - For helping me to advance my vision for this gem into what it is today and what is being documented here.</li>
  <li><a href="https://github.com/n2diving">Alexis Gormley</a> - For suggesting the <a href="https://github.com/lord/slate">Slate theme</a> for the documentation, designing the gem’s branding, and proofing the documentation.</li>
  <li><a href="https://github.com/VonTeacher">Vaughn Weiss</a> - For reviewing and revising the Blocks Docs.</li>
</ul>

          
        
      </div>
      <div class="dark-box">
        
  <div class="lang-selector">
    
      
        <a href="#" data-language-name="erb">erb</a>
      
    
      
        <a href="#" data-language-name="haml">haml</a>
      
    
      
        <a href="#" data-language-name="ruby">ruby</a>
      
    
  </div>


      </div>
    </div>
  </body>
</html>
